(this["webpackJsonpwebgl-testing"]=this["webpackJsonpwebgl-testing"]||[]).push([[0],{18:function(t,e,n){t.exports=n.p+"static/media/perspective.world-point-to-screen.34658b6e.vert"},19:function(t,e,n){t.exports=n.p+"static/media/perspective.world-vector-to-screen.79a1763d.vert"},20:function(t,e,n){t.exports=n.p+"static/media/main.a91ec25c.vert"},21:function(t,e,n){t.exports=n.p+"static/media/main.a27a283f.frag"},22:function(t,e,n){t.exports=n.p+"static/media/main.d0ebbab8.vert"},23:function(t,e,n){t.exports=n.p+"static/media/main.cb7cba22.frag"},24:function(t,e,n){t.exports=n(65)},59:function(t,e,n){},61:function(t,e,n){},62:function(t,e,n){},63:function(t){t.exports=JSON.parse('{"en":{"type-balzac":"Slow (5\')","type-golgoth":"Very Slow (10\')","type-hydre":"Fast (2\')","type-tyson":"Very Fast (1\')"},"fr":{"story1":"Les habitants de l\'\xeele flottante VOLCANO sont en danger!","story2a":"VOLCANO va cesser de flotter dans...","story2b":"Et tomber dans le n\xe9ant !","story3":"Il faut les aider \xe0 rejoindre l\'\xeele flottante MOLINO.","story4":"Pour cela, ils devront sauter sur un rocher pluvieux sur lequel il n\'y a de la place que pour 2.","story5":"Il leur faudra donc utiliser l\'unique parapluie pour ne pas se mouiller.","type-balzac":"Lent (5\')","type-golgoth":"Tr\xe8s Lent (10\')","type-hydre":"Rapide (2\')","type-tyson":"Tr\xe8s Rapide (1\')"}}')},64:function(t,e,n){},65:function(t,e,n){"use strict";n.r(e);var r=n(8),a=n(0),i=n.n(a),o=n(14),s=n.n(o),c=(n(59),n(2)),u=n(3),f=n(6),h=n(5),l=n(11),p=n(1),m=n.n(p),v=n(4),d=function(){function t(e){var n=this;Object(c.a)(this,t),this._x=0,this._y=0,this._down=!1,this._downTime=0,this._eventDown=!1,this._eventUp=!1,this.canvas=void 0,this.onMouseMove=function(t){n.computeCoords(t.clientX,t.clientY)},this.onTouchMove=function(t){var e=t.touches[0];n.computeCoords(e.clientX,e.clientY)},this.onMouseDown=function(t){n.onDown(t.clientX,t.clientY)},this.onTouchStart=function(t){var e=t.touches[0];n.onDown(e.clientX,e.clientY)},this.onMouseUp=function(t){n.onUp(t.clientX,t.clientY)},this.onTouchEnd=function(t){var e=t.touches[0];n.onUp(e.clientX,e.clientY)},this.canvas=e,window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mousedown",this.onMouseDown,!0),window.addEventListener("touchstart",this.onTouchStart,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("touchend",this.onTouchEnd,!0)}return Object(u.a)(t,[{key:"reset",value:function(){this._eventDown=!1,this._eventUp=!1}},{key:"onDown",value:function(t,e){0===this._downTime&&(this.computeCoords(t,e),this._down=!0,this._eventDown=!0,this._downTime=Date.now())}},{key:"onUp",value:function(t,e){0!==this._downTime&&(this.computeCoords(t,e),this._down=!1,this._eventUp=!0,this._downTime=0)}},{key:"computeCoords",value:function(t,e){var n=this.canvas.getBoundingClientRect(),r=t-n.left,a=e-n.top,i=n.width,o=n.height;this._x=2*(r/i-.5),this._y=2*(a/o-.5)}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"down",get:function(){return this._down}},{key:"eventUp",get:function(){return this._eventUp}},{key:"eventDown",get:function(){return this._eventDown}}]),t}(),y={loadImage:function(t){return new Promise((function(e,n){var r=new Image;r.onload=function(){return e(r)},r.onerror=function(){console.error("Unable to load image from URL:",t),n(t)},r.src=t}))},loadJson:function(t){return E.apply(this,arguments)},loadText:g};function g(t){return b.apply(this,arguments)}function b(){return(b=Object(v.a)(m.a.mark((function t(e){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:return n=t.sent,t.next=6,n.text();case 6:return r=t.sent,t.abrupt("return",r);case 10:throw t.prev=10,t.t0=t.catch(0),console.error("Unable to load text from URL:",e),console.error(t.t0),t.t0;case 15:case"end":return t.stop()}}),t,null,[[0,10]])})))).apply(this,arguments)}function E(){return(E=Object(v.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g(e);case 2:return n=t.sent,t.prev=3,t.abrupt("return",JSON.parse(n));case 7:throw t.prev=7,t.t0=t.catch(3),console.error("Unable to parse JSON:",e),console.error(t.t0),t.t0;case 12:case"end":return t.stop()}}),t,null,[[3,7]])})))).apply(this,arguments)}var T=function(){function t(e,n,r){Object(c.a)(this,t),this.gl=e,this.id=n,this.texture=void 0,this.target=void 0,this.units=void 0;var a=e.createTexture();if(!a)throw Error('[FlatLand] Unable to create texture "'.concat(n,'"!'));switch(this.texture=a,r){case"2d":this.target=e.TEXTURE_2D;break;case"cubeMap":this.target=e.TEXTURE_CUBE_MAP;break;default:throw Error('[FlatLand.Texture] Unknow target "'.concat(r,'"! Available targets are "2d", "cubeMap", "3d" and "2dArray".'))}this.units=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7,e.TEXTURE8,e.TEXTURE9,e.TEXTURE10,e.TEXTURE11,e.TEXTURE12,e.TEXTURE13,e.TEXTURE14,e.TEXTURE15]}return Object(u.a)(t,[{key:"attachToUnit",value:function(t){var e=this.gl,n=this.texture,r=this.target,a=this.units;if(t<0)throw Error("[FlatLand.Texture.attachToUnit] unitIndex must be positive!");if(t>a.length-1)throw Error("[FlatLand.Texture.attachToUnit] unitIndex must be lower than ".concat(a.length,"!"));e.activeTexture(a[t]),e.bindTexture(r,n)}}]),t}(),O=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;Object(c.a)(this,n),(r=e.call(this,t.gl,t.id,"2d")).params=t;var a=t.gl,i=t.linear?a.LINEAR:a.NEAREST;return a.bindTexture(a.TEXTURE_2D,r.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.source),r}return Object(u.a)(n,[{key:"update",value:function(t){var e=this.params.gl;e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}},{key:"destroy",value:function(){return!!this.params.confirmDestroy()&&(this.params.gl.deleteTexture(this.texture),!0)}},{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}}]),n}(T),_=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;Object(c.a)(this,n),(r=e.call(this,t.gl,t.id,"cubeMap")).params=t;var a=t.gl;return a.bindTexture(a.TEXTURE_CUBE_MAP,r.texture),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosX),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegX),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosY),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegY),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosZ),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegZ),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a instanceof WebGL2RenderingContext&&a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_R,a.CLAMP_TO_EDGE),a.generateMipmap(a.TEXTURE_CUBE_MAP),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),r}return Object(u.a)(n,[{key:"destroy",value:function(){return!!this.params.confirmDestroy()&&(this.params.gl.deleteTexture(this.texture),!0)}}]),n}(T),A=function(){function t(){Object(c.a)(this,t),this.lockedIds=new Set,this.map=new Map}return Object(u.a)(t,[{key:"lockAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=100,r=this.lockedIds;case 2:if(!r.has(e)){t.next=7;break}return t.next=5,w(n);case 5:t.next=2;break;case 7:r.add(e);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"unlock",value:function(t){this.lockedIds.delete(t)}},{key:"addAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e,n){var r,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.lockAsync(e);case 2:if(t.prev=2,!(r=this.map).has(e)){t.next=10;break}if(a=r.get(e)){t.next=8;break}throw Error("Impossible error on map!");case 8:return a.count++,t.abrupt("return",a.value);case 10:return t.next=12,n();case 12:return i=t.sent,r.set(e,{count:1,value:i}),t.abrupt("return",i);case 15:return t.prev=15,this.unlock(e),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[2,,15,18]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"add",value:function(t,e){var n=this.map;if(n.has(t)){var r=n.get(t);if(!r)throw Error("Impossible error on map!");return r.count++,r.value}var a=e();return n.set(t,{count:1,value:a}),a}},{key:"remove",value:function(t){var e=this.map.get(t);return e?(e.count--,e.count<=0&&this.map.delete(t),e.count):-1}}]),t}();function w(t){return x.apply(this,arguments)}function x(){return(x=Object(v.a)(m.a.mark((function t(e){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return window.setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var M,j,k,L=function(){function t(e){Object(c.a)(this,t),this.gl=e,this.imageTexturesMap=new A,this.cubeMapTexturesMap=new A}return Object(u.a)(t,[{key:"createImageTextureAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.imageTexturesMap.addAsync(e.url,Object(v.a)(m.a.mark((function t(){var r,a,i,o,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.gl,a=e.url,i=e.linear,t.next=4,y.loadImage(a);case 4:return o=t.sent,s=new O({id:a,gl:r,source:o,width:o.width,height:o.height,linear:i,confirmDestroy:function(){return 0===n.imageTexturesMap.remove(a)}}),t.abrupt("return",s);case 7:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createCubeMapTextureAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.cubeMapTexturesMap.addAsync(e,Object(v.a)(m.a.mark((function t(){var r,a,i,o,s,c,u,f,h;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.gl,a=e.split("?"),t.next=4,y.loadImage(a.join("1"));case 4:return i=t.sent,t.next=7,y.loadImage(a.join("2"));case 7:return o=t.sent,t.next=10,y.loadImage(a.join("3"));case 10:return s=t.sent,t.next=13,y.loadImage(a.join("4"));case 13:return c=t.sent,t.next=16,y.loadImage(a.join("5"));case 16:return u=t.sent,t.next=19,y.loadImage(a.join("6"));case 19:return f=t.sent,h=new _({gl:r,id:e,sourcePosX:i,sourceNegX:o,sourcePosY:s,sourceNegY:c,sourcePosZ:u,sourceNegZ:f,confirmDestroy:function(){return 0===n.cubeMapTexturesMap.remove(e)}}),t.abrupt("return",h);case 22:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),F=n(9),R=n(7),U=n(15);!function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4"}(M||(M={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4",t[t.FLOAT_MAT2=4]="FLOAT_MAT2",t[t.FLOAT_MAT3=5]="FLOAT_MAT3",t[t.FLOAT_MAT4=6]="FLOAT_MAT4",t[t.BYTE=7]="BYTE",t[t.UNSIGNED_BYTE=8]="UNSIGNED_BYTE",t[t.SHORT=9]="SHORT",t[t.UNSIGNED_SHORT=10]="UNSIGNED_SHORT",t[t.INT=11]="INT",t[t.UNSIGNED_INT=12]="UNSIGNED_INT",t[t.BOOL=13]="BOOL",t[t.SAMPLER_2D=14]="SAMPLER_2D",t[t.SAMPLER_CUBE=15]="SAMPLER_CUBE"}(j||(j={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4",t[t.FLOAT_MAT2=4]="FLOAT_MAT2",t[t.FLOAT_MAT3=5]="FLOAT_MAT3",t[t.FLOAT_MAT4=6]="FLOAT_MAT4"}(k||(k={}));var C={getAttributeSize:function(t){switch(t){case M.FLOAT_VEC2:return 2;case M.FLOAT_VEC3:return 3;case M.FLOAT_VEC4:return 4;default:return 1}},getAttributeTypeCodeName:function(t){return N.get(t)},getUniformTypeCodeName:function(t){return D.get(t)},getVaryingTypeCodeName:function(t){return S.get(t)},getWebGLTypeFromAttributeType:function(t,e){switch(e){case M.FLOAT_VEC2:return t.FLOAT_VEC2;case M.FLOAT_VEC3:return t.FLOAT_VEC3;case M.FLOAT_VEC4:return t.FLOAT_VEC4;default:return t.FLOAT}}};var N=new Map;N.set(M.FLOAT,"float"),N.set(M.FLOAT_VEC2,"vec2"),N.set(M.FLOAT_VEC3,"vec3"),N.set(M.FLOAT_VEC4,"vec4");var S=new Map;S.set(k.FLOAT,"float"),S.set(k.FLOAT_VEC2,"vec2"),S.set(k.FLOAT_VEC3,"vec3"),S.set(k.FLOAT_VEC4,"vec4"),S.set(k.FLOAT_MAT2,"mat2"),S.set(k.FLOAT_MAT3,"mat3"),S.set(k.FLOAT_MAT4,"mat4");var D=new Map;D.set(j.BOOL,"bool"),D.set(j.BYTE,"int"),D.set(j.SHORT,"int"),D.set(j.INT,"int"),D.set(j.UNSIGNED_BYTE,"uint"),D.set(j.UNSIGNED_SHORT,"uint"),D.set(j.UNSIGNED_INT,"uint"),D.set(j.SAMPLER_2D,"sampler2D"),D.set(j.SAMPLER_CUBE,"samplerCube"),D.set(j.FLOAT,"float"),D.set(j.FLOAT_VEC2,"vec2"),D.set(j.FLOAT_VEC3,"vec3"),D.set(j.FLOAT_VEC4,"vec4"),D.set(j.FLOAT_MAT2,"mat2"),D.set(j.FLOAT_MAT3,"mat3"),D.set(j.FLOAT_MAT4,"mat4");var P=function(){function t(e,n,r){Object(c.a)(this,t),this.uniformsDefinition=r,this.uniformSetters=new Map,this.attachProgram(e,n)}return Object(u.a)(t,[{key:"set",value:function(t,e){var n=this.uniformSetters.get(t);n&&n(e)}},{key:"exists",value:function(t){return this.uniformSetters.has(t)}},{key:"attachProgram",value:function(t,e){for(var n=0,r=Object.keys(this.uniformsDefinition);n<r.length;n++){var a=r[n];if(t.getUniformLocation(e,a)){var i=this.uniformsDefinition[a],o=!!(i.size&&i.size>1);switch(i.type){case j.BYTE:case j.UNSIGNED_BYTE:case j.SHORT:case j.UNSIGNED_SHORT:case j.INT:case j.UNSIGNED_INT:case j.SAMPLER_2D:case j.SAMPLER_CUBE:this.attachProgramInt(t,e,a,o);break;case j.FLOAT:this.attachProgramFloat(t,e,a,o);break;case j.FLOAT_VEC2:this.attachProgramVec2(t,e,a,o);break;case j.FLOAT_VEC3:this.attachProgramVec3(t,e,a,o);break;case j.FLOAT_VEC4:this.attachProgramVec4(t,e,a,o);break;case j.FLOAT_MAT2:this.attachProgramMat2(t,e,a,o);break;case j.FLOAT_MAT3:this.attachProgramMat3(t,e,a,o);break;case j.FLOAT_MAT4:this.attachProgramMat4(t,e,a,o);break;default:throw Error('[AbstractShader.attachProgram] Unknown type for uniform "'.concat(a,'": ').concat(i.type,"[").concat(i.size||1,"]!"))}}else I(a)}}},{key:"attachProgramInt",value:function(t,e,n,r){var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,r?function(e){return t.uniform1iv(a,e)}:function(e){return t.uniform1i(a,e)})}},{key:"attachProgramFloat",value:function(t,e,n,r){var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,r?function(e){return t.uniform1fv(a,e)}:function(e){return t.uniform1f(a,e)})}},{key:"attachProgramVec2",value:function(t,e,n,r){if(r)throw Error("You cannot use array of vec2!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniform2fv(a,e)}))}},{key:"attachProgramVec3",value:function(t,e,n,r){if(r)throw Error("You cannot use array of vec3!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniform3fv(a,e)}))}},{key:"attachProgramVec4",value:function(t,e,n,r){if(r)throw Error("You cannot use array of vec4!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniform4fv(a,e)}))}},{key:"attachProgramMat2",value:function(t,e,n,r){if(r)throw Error("You cannot use array of mat2!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniformMatrix2fv(a,!1,e)}))}},{key:"attachProgramMat3",value:function(t,e,n,r){if(r)throw Error("You cannot use array of mat3!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniformMatrix3fv(a,!1,e)}))}},{key:"attachProgramMat4",value:function(t,e,n,r){if(r)throw Error("You cannot use array of mat4!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniformMatrix4fv(a,!1,e)}))}}]),t}();function I(t){console.warn('Uniform "'.concat(t,'" has not been compiled in this program!')),console.warn("Shader compilation removes everything that is not used by the code.")}var V=Float32Array.BYTES_PER_ELEMENT,B=function(){function t(e,n,r){Object(c.a)(this,t),this.gl=e,this.prg=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=[],this.uniformSetters=void 0,this.vertexShader=n,this.fragmentShader=r}return Object(u.a)(t,[{key:"bindAttribs",value:function(t){var e=this.gl,n=this.prg,r=this.attributes;if(!n)throw Error("This program has not been attached yet!");e.bindBuffer(e.ARRAY_BUFFER,t);var a,i=Object(U.a)(r);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.enableVertexAttribArray(o.location),e.vertexAttribPointer(o.location,o.size,e.FLOAT,o.normalization,o.totalSize,o.offset)}}catch(s){i.e(s)}finally{i.f()}}},{key:"attach",value:function(){var t=Object(v.a)(m.a.mark((function t(){var e,n,r,a,i,o,s,c;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.prg&&this.detach(),e=et(this.vertexShader),(n=et(this.fragmentShader)).attributes={},n.varyings=Object(R.a)(Object(R.a)({},e.varyings),n.varyings),t.next=7,Y(e);case 7:return r=t.sent,t.next=10,W(n);case 10:if(a=t.sent,i=this.gl,o=X(i,r),s=z(i,a),c=i.createProgram()){t.next=17;break}throw Error("Unable to create a new WebGLProgram!");case 17:this.prg=c,i.attachShader(c,o),i.attachShader(c,s),i.linkProgram(c),this.prepareUniformsForFastBinding(e.attributes),this.uniformSetters=new P(this.gl,this.prg,Object(R.a)(Object(R.a)({},e.uniforms),n.uniforms));case 23:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"detach",value:function(){var t=this.prg,e=this.gl;t&&(e.deleteProgram(t),delete this.prg)}},{key:"prepareUniformsForFastBinding",value:function(t){var e=this.gl,n=this.prg;if(!n)throw Error("This program has not been attached yet!");for(var r=[],a=0,i=0,o=Object.keys(t);i<o.length;i++){var s=o[i],c=t[s],u={location:e.getAttribLocation(n,s),offset:a,normalization:!1,size:C.getAttributeSize(c),totalSize:0,type:C.getWebGLTypeFromAttributeType(e,c)};r.push(u),a+=u.size*V}for(var f=a,h=0,l=r;h<l.length;h++){l[h].totalSize=f}this.attributes=r}},{key:"use",value:function(){var t=this.prg,e=this.gl;if(!t)throw Error("This program has not been attached yet!");e.useProgram(t)}},{key:"uniforms",get:function(){var t=this.uniformSetters;if(!t)throw Error("Can't get uniforms because the program has not been attached yet!\nprg.attach()");return t}}]),t}();function X(t,e){return G(t.VERTEX_SHADER,t,e)}function z(t,e){return G(t.FRAGMENT_SHADER,t,e)}function G(t,e,n){if(t!==e.VERTEX_SHADER&&t!==e.FRAGMENT_SHADER)throw Error("Type must be VERTEX_SHADER or FRAGMENT_SHADER!");var r=e.createShader(t);if(!r)throw Error("Unable to create a ".concat(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT"," shader!"));if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(r)||"NULL";throw console.error("An error occurred compiling the shader with the following code:"),console.info(function(t){var e,n=[],r=t.split("\n"),a=0,i=Object(U.a)(r);try{for(i.s();!(e=i.n()).done;){var o=e.value;a++,n.push("".concat(ot(a)," | ").concat(o))}}catch(s){i.e(s)}finally{i.f()}return n.join("\n")}(n)),console.error("Here is the error: ".concat(a)),console.info(function(t,e){var n=t.split(/\n\r?/);n.unshift(""),tt.lastIndex=-1;var r=tt.exec(e);if(!r)return t;for(var a=Object(F.a)(r,3)[2],i=Number(a),o=Math.max(1,i-2),s=Math.min(n.length-1,i+2),c=["Here is an extract of the shader code:"],u=o;u<=s;u++)c.push("| ".concat(u,":    ").concat(n[u]));return c.join("\n")}(n,a)),Error("Unable to create a ".concat(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT"," shader!"))}return r}function Y(t){return H.apply(this,arguments)}function H(){return(H=Object(v.a)(m.a.mark((function t(e){var n,r,a,i,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],(r=q(e.uniforms))&&n.push(r),(a=K(e.attributes))&&n.push(a),(i=J(e.varyings))&&n.push(i),t.next=9,Q(e.functions);case 9:return o=t.sent,n.push(o),t.abrupt("return",n.join("\n"));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function W(t){return Z.apply(this,arguments)}function Z(){return(Z=Object(v.a)(m.a.mark((function t(e){var n,r,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=["precision mediump float;"],(r=q(e.uniforms))&&n.push(r),(a=J(e.varyings))&&n.push(a),t.next=7,Q(e.functions);case 7:return i=t.sent,n.push(i),t.abrupt("return",n.join("\n"));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function q(t){return Object.keys(t).map((function(e){var n=t[e],r=C.getUniformTypeCodeName(n.type);if(!r)throw Error('Unknown type for uniform "'.concat(e,'": ').concat(n,"!"));var a=(n.size||0)>1?"[".concat(n.size,"]"):"";return"uniform ".concat(r," ").concat(e).concat(a,";")})).join("\n")}function J(t){return Object.keys(t).map((function(e){var n=t[e],r=C.getVaryingTypeCodeName(n.type);if(!r)throw Error('Unknown type for varying "'.concat(e,'": ').concat(n,"!"));var a=(n.size||0)>1?"[".concat(n.size,"]"):"";return"varying ".concat(r," ").concat(e).concat(a,";")})).join("\n")}function K(t){return Object.keys(t).map((function(e){var n=t[e],r=C.getAttributeTypeCodeName(n);if(!r)throw Error('Unknown type for attribute "'.concat(e,'": ').concat(n,"!"));return"attribute ".concat(r," ").concat(e,";")})).join("\n")}function Q(t){return $.apply(this,arguments)}function $(){return($=Object(v.a)(m.a.mark((function t(e){var n,r,a,i,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=Object.keys(e);case 2:if(!(r.length>0)){t.next=17;break}if(a=r.pop()){t.next=6;break}return t.abrupt("break",17);case 6:if(i=e[a],!Array.isArray(i)){t.next=11;break}n.push.apply(n,Object(l.a)(i)),t.next=15;break;case 11:return t.next=13,y.loadText(i);case 13:o=t.sent,n.push(o);case 15:t.next=2;break;case 17:return t.abrupt("return",n.join("\n"));case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var tt=/ERROR: ([0-9]+):([0-9]+):/g;function et(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{var n={attributes:Object(R.a)({},t.attributesDefinition),functions:Object(R.a)({},t.functionsDefinition),uniforms:Object(R.a)({},t.uniformsDefinition),varyings:Object(R.a)({},t.varyingsDefinition)};if(0===e.length&&"undefined"===typeof n.functions.main)throw Error("A shader must have a 'void main()' function!");e.push(t);var r,a=Object(U.a)(t.dependenciesDefinition);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(-1===e.indexOf(i)){var o={attributes:Object(R.a)({},i.attributesDefinition),functions:Object(R.a)({},i.functionsDefinition),uniforms:Object(R.a)({},i.uniformsDefinition),varyings:Object(R.a)({},i.varyingsDefinition)};delete o.functions.main,rt(n.attributes,o.attributes),at(n.uniforms,o.uniforms),it(n.varyings,o.varyings),nt(n.functions,o.functions)}}}catch(s){a.e(s)}finally{a.f()}return n}catch(c){throw Error("Error in ".concat(t.constructor.name,":\n").concat(c))}}function nt(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=t[a],o=e[a];i||(t[a]=o)}}function rt(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=t[a],o=e[a];if(i){if(i!==o)throw Error('Attribute "'.concat(a,'" is redeclared in a dependency, but with a different type!'))}else t[a]=o}}function at(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=t[a],o=e[a];if(i){if(i.type!==o.type)throw Error('Uniform "'.concat(a,'" is redeclared in a dependency, but with a different type!'));if((i.size||1)!==(o.size||1))throw Error('Uniform "'.concat(a,'[]" is redeclared in a dependency, but with a different number of items!'))}else t[a]=o}}function it(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=t[a],o=e[a];if(i){if(i.type!==o.type)throw Error('Varying "'.concat(a,'" is redeclared in a dependency, but with a different type!'));if((i.size||1)!==(o.size||1))throw Error('Varying "'.concat(a,'[]" is redeclared in a dependency, but with a different number of items!'))}else t[a]=o}}function ot(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n="".concat(t);n.length<e;)n=" ".concat(n);return n}var st=function t(){Object(c.a)(this,t)},ct=function(t){return new ft(t)},ut=function(t){return new ht(t)},ft=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).definition=void 0,r.definition={uniforms:mt(t.uniforms),attributes:dt(t.attributes),varyings:gt(t.varyings),functions:t.functions||{},dependencies:lt(t.dependencies)},r}return Object(u.a)(n,[{key:"uniformsDefinition",get:function(){return this.definition.uniforms}},{key:"attributesDefinition",get:function(){return this.definition.attributes}},{key:"varyingsDefinition",get:function(){return this.definition.varyings}},{key:"functionsDefinition",get:function(){return this.definition.functions}},{key:"dependenciesDefinition",get:function(){return this.definition.dependencies}}]),n}(st),ht=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).definition=void 0,r.definition={uniforms:mt(t.uniforms),attributes:{},varyings:{},functions:t.functions||{},dependencies:pt(t.dependencies)},r}return Object(u.a)(n,[{key:"uniformsDefinition",get:function(){return this.definition.uniforms}},{key:"attributesDefinition",get:function(){return this.definition.attributes}},{key:"varyingsDefinition",get:function(){return this.definition.varyings}},{key:"functionsDefinition",get:function(){return this.definition.functions}},{key:"dependenciesDefinition",get:function(){return this.definition.dependencies}}]),n}(st);function lt(t){return Array.isArray(t)?t.map((function(t){return new ft(t)})):[]}function pt(t){return Array.isArray(t)?t.map((function(t){return new ht(t)})):[]}function mt(t){if(!t)return{};for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];e[a]=vt(t[a])}return e}function vt(t){if(!Array.isArray(t))return vt([t,1]);var e=Object(F.a)(t,2),n=e[0],r=e[1];switch(n){case"vec2":return{type:j.FLOAT_VEC2,size:r};case"vec3":return{type:j.FLOAT_VEC3,size:r};case"vec4":return{type:j.FLOAT_VEC4,size:r};case"mat2":return{type:j.FLOAT_MAT2,size:r};case"mat3":return{type:j.FLOAT_MAT3,size:r};case"mat4":return{type:j.FLOAT_MAT4,size:r};case"sampler2D":return{type:j.SAMPLER_2D,size:r};case"samplerCube":return{type:j.SAMPLER_CUBE,size:r};default:return{type:j.FLOAT,size:r}}}function dt(t){if(!t)return{};for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];e[a]=yt(t[a])}return e}function yt(t){switch(t){case"vec2":return M.FLOAT_VEC2;case"vec3":return M.FLOAT_VEC3;case"vec4":return M.FLOAT_VEC4;default:return M.FLOAT}}function gt(t){if(!t)return{};for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];e[a]=bt(t[a])}return e}function bt(t){if(!Array.isArray(t))return bt([t,1]);var e=Object(F.a)(t,2),n=e[0],r=e[1];switch(n){case"vec2":return{type:k.FLOAT_VEC2,size:r};case"vec3":return{type:k.FLOAT_VEC3,size:r};case"vec4":return{type:k.FLOAT_VEC4,size:r};case"mat2":return{type:k.FLOAT_MAT2,size:r};case"mat3":return{type:k.FLOAT_MAT3,size:r};case"mat4":return{type:k.FLOAT_MAT4,size:r};default:return{type:k.FLOAT,size:r}}}for(var Et=function(){function t(e){Object(c.a)(this,t),this.gl=e,this.programMap=new A}return Object(u.a)(t,[{key:"createProgramAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e,n,r){var a=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.programMap.addAsync(e,Object(v.a)(m.a.mark((function t(){var e,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.gl,i=new B(e,ct(n),ut(r)),t.next=4,i.attach();case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()}]),t}(),Tt=function(){function t(e){Object(c.a)(this,t),this.params=e}return Object(u.a)(t,[{key:"setData",value:function(t){var e=this.params,n=e.gl,r=e.buffer;n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}},{key:"bind",value:function(){var t=this.params,e=t.gl,n=t.buffer;e.bindBuffer(e.ARRAY_BUFFER,n)}},{key:"destroy",value:function(){var t=this.params,e=t.gl,n=t.buffer;!1!==(0,t.confirmDestroy)()&&e.deleteBuffer(n)}},{key:"buffer",get:function(){return this.params.buffer}}]),t}(),Ot=function(){function t(e){Object(c.a)(this,t),this.gl=e,this.arrayBufferMap=new A}return Object(u.a)(t,[{key:"createArrayBuffer",value:function(t,e){var n=this;return this.arrayBufferMap.add(t,(function(){var r=n.gl,a=r.createBuffer();if(!a)throw Error("Unable to create a new WebGLBuffer!");var i=new Tt({gl:r,buffer:a,confirmDestroy:function(){return 0===n.arrayBufferMap.remove(t)}});return i.setData(e),i}))}}]),t}(),_t=function t(){Object(c.a)(this,t)},At=new Float32Array(4096),wt=new Float32Array(4096),xt=new Float32Array(3),Mt=new Float32Array(3),jt=new Float32Array(3),kt=new Float32Array(3),Lt=0;Lt<4096;Lt++){var Ft=Math.PI*Lt/2048;At[Lt]=Math.cos(Ft),wt[Lt]=Math.sin(Ft)}var Rt={areEqual:function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},createVec3:function(){return new Float32Array(3)},createVec4:function(){return new Float32Array(4)},add3:function(t,e,n){n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2]},substract3:function(t,e,n){n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2]},cross3:function(t,e,n){n[0]=t[1]*e[2]-t[2]*e[1],n[1]=t[2]*e[0]-t[0]*e[2],n[2]=t[0]*e[1]-t[1]*e[0]},dot3:function(t,e){var n=Object(F.a)(t,3),r=n[0],a=n[1],i=n[2],o=Object(F.a)(e,3);return r*o[0]+a*o[1]+i*o[2]},length3:function(t){return Math.sqrt(Rt.dot3(t,t))},normalize3:function(t,e){var n=Rt.length3(t),r=n>0?1/n:1;e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r},orbital3:function(t,e,n){var r=Math.sin(t),a=Math.cos(t),i=e-.5*Math.PI;n[0]=a*Math.cos(i),n[1]=a*Math.sin(i),n[2]=r},length4:function(t){var e=Object(F.a)(t,4),n=e[0],r=e[1],a=e[2],i=e[3];return Math.sqrt(n*n+r*r+a*a+i*i)},normalize4:function(t,e){var n=Rt.length4(t);e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n},transform4:function(t,e,n){n[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],n[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],n[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],n[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3]}},Ut={areEqual:Rt.areEqual,createMat3:function(){return new Float32Array(9)},createMat4:function(){return new Float32Array(16)},identity3:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},extract3From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},extractX3From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2]},extractX4From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]},extractY3From4:function(t,e){e[0]=t[4],e[1]=t[5],e[2]=t[6]},extractY4From4:function(t,e){e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7]},extractZ3From4:function(t,e){e[0]=t[8],e[1]=t[9],e[2]=t[10]},extractZ4From4:function(t,e){e[0]=t[8],e[1]=t[9],e[2]=t[10],e[3]=t[11]},lookAt4:function(t,e,n,r){r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1;var a=xt,i=Mt,o=jt,s=kt;Rt.substract3(e,t,a),Rt.normalize3(a,a),Rt.normalize3(n,s),Rt.cross3(a,s,i),Rt.cross3(i,a,o),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=0,r[4]=o[0],r[5]=o[1],r[6]=o[2],r[7]=0,r[8]=a[0],r[9]=a[1],r[10]=a[2],r[11]=0},multiply3:function(t,e,n){n[0]=t[0]*e[0]+t[3]*e[1]+t[6]*e[2],n[1]=t[1]*e[0]+t[4]*e[1]+t[7]*e[2],n[2]=t[2]*e[0]+t[5]*e[1]+t[8]*e[2],n[3]=t[0]*e[3]+t[3]*e[4]+t[6]*e[5],n[4]=t[1]*e[3]+t[4]*e[4]+t[7]*e[5],n[5]=t[2]*e[3]+t[5]*e[4]+t[8]*e[5],n[6]=t[0]*e[6]+t[3]*e[7]+t[6]*e[8],n[7]=t[1]*e[6]+t[4]*e[7]+t[7]*e[8],n[8]=t[2]*e[6]+t[5]*e[7]+t[8]*e[8]},identity4:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},multiply4:function(t,e,n){var r=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],a=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],i=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],o=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],s=t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],c=t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],u=t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],f=t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],h=t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],l=t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],p=t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],m=t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],v=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],d=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],y=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],g=t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15];n[0]=r,n[1]=a,n[2]=i,n[3]=o,n[4]=s,n[5]=c,n[6]=u,n[7]=f,n[8]=h,n[9]=l,n[10]=p,n[11]=m,n[12]=v,n[13]=d,n[14]=y,n[15]=g},invert4:function(t,e){var n=Object(F.a)(t,16),r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],c=n[5],u=n[6],f=n[7],h=n[8],l=n[9],p=n[10],m=n[11],v=n[12],d=n[13],y=n[14],g=n[15],b=r*c-s*a,E=r*l-h*a,T=r*d-v*a,O=s*l-h*c,_=s*d-v*c,A=h*d-v*l,w=i*f-u*o,x=i*m-p*o,M=i*g-y*o,j=u*m-p*f,k=u*g-y*f,L=p*g-y*m,R=b*L-E*k+T*j+O*M-_*x+A*w;if(Math.abs(R)<1e-8)return!1;var U=1/R;return e[0]=(c*L-l*k+d*j)*U,e[4]=(h*k-s*L-v*j)*U,e[8]=(f*A-m*_+g*O)*U,e[12]=(p*_-u*A-y*O)*U,e[1]=(l*M-a*L-d*x)*U,e[5]=(r*L-h*M+v*x)*U,e[9]=(m*T-o*A-g*E)*U,e[13]=(i*A-p*T+y*E)*U,e[2]=(a*k-c*M+d*w)*U,e[6]=(s*M-r*k-v*w)*U,e[10]=(o*_-f*T+g*b)*U,e[14]=(u*T-i*_-y*b)*U,e[3]=(c*x-a*j-l*w)*U,e[7]=(r*j-s*x+h*w)*U,e[11]=(f*E-o*O-m*b)*U,e[15]=(i*O-u*E+p*b)*U,!0},rotation4X:function(t,e){var n=Math.cos(t),r=Math.sin(t);e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1},rotation4Y:function(t,e){var n=Math.cos(t),r=Math.sin(t);e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1},rotation4Z:function(t,e){var n=Math.cos(t),r=Math.sin(t);e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}};var Ct={deg2rad:function(t){return t*Math.PI/180},rad2deg:function(t){return 180*t/Math.PI},cos:function(t){return At[4095&(0|t)]},sin:function(t){return wt[4095&(0|t)]},clamp:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t<e?e:t>n?n:t},vector:Rt,matrix:Ut,M4_00:0,M4_10:1,M4_20:2,M4_30:3,M4_01:4,M4_11:5,M4_21:6,M4_31:7,M4_02:8,M4_12:9,M4_22:10,M4_32:11,M4_03:12,M4_13:13,M4_23:14,M4_33:15,M3_00:0,M3_10:1,M3_20:2,M3_01:3,M3_11:4,M3_21:5,M3_02:6,M3_12:7,M3_22:8},Nt=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).cameraMatrix=Ct.matrix.createMat4(),t.rotationY=Ct.matrix.createMat4(),t.rotationX=Ct.matrix.createMat4(),t}return Object(u.a)(n,[{key:"extractCameraMatrix",value:function(t){Ct.matrix.extract3From4(this.cameraMatrix,t)}},{key:"orbit",value:function(t,e,n,r,a,i){var o=this.rotationY,s=this.rotationX,c=this.cameraMatrix,u=Ct.clamp(a,-1.570796326794896,1.570796326794896),f=i;Ct.matrix.rotation4X(u,s),Ct.matrix.rotation4Y(-f,o),Ct.matrix.identity4(c),Ct.matrix.multiply4(s,o,c);var h=t,l=e,p=n+r;c[Ct.M4_03]=-h,c[Ct.M4_13]=-l,c[Ct.M4_23]=-p}}]),n}(_t),St=n(18),Dt=n.n(St),Pt=n(19),It=n.n(Pt),Vt=39.6*Math.PI/180,Bt=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n),(t=e.call(this)).perspectiveMatrix=Ct.matrix.createMat4(),t.cameraMatrix3=Ct.matrix.createMat3(),t.fieldAngle=Vt,t.near=.1,t.far=1e3;return t.orbit(0,0,0,15,0,0),t}return Object(u.a)(n,[{key:"setUniformValues",value:function(t,e,n){var r=this.near,a=this.far,i=this.fieldAngle,o=Math.tan(.5*(Math.PI-i)),s=1/(r-a),c=this.perspectiveMatrix;c[Ct.M4_00]=o*n/e,c[Ct.M4_10]=0,c[Ct.M4_20]=0,c[Ct.M4_30]=0,c[Ct.M4_01]=0,c[Ct.M4_11]=o,c[Ct.M4_21]=0,c[Ct.M4_31]=0,c[Ct.M4_02]=0,c[Ct.M4_12]=0,c[Ct.M4_22]=(r+a)*s,c[Ct.M4_32]=-1,c[Ct.M4_03]=0,c[Ct.M4_13]=0,c[Ct.M4_23]=r*a*s*2,c[Ct.M4_33]=0,Ct.matrix.extract3From4(this.cameraMatrix,this.cameraMatrix3),t.use(),t.uniforms.set("uniCameraMatrix",this.cameraMatrix),t.uniforms.set("uniCameraMatrix3",this.cameraMatrix3),t.uniforms.set("uniPerspectiveMatrix",this.perspectiveMatrix)}},{key:"id",get:function(){return"[CAMERA/PERSPECTIVE]"}},{key:"vertexShader",get:function(){return{uniforms:{uniPerspectiveMatrix:"mat4",uniCameraMatrix:"mat4",uniCameraMatrix3:"mat3"},functions:{worldPointToScreen:Dt.a,worldVectorToScreen:It.a}}}}]),n}(Nt),Xt=function(){function t(e){var n=this;Object(c.a)(this,t),this.resolution=1,this.onAnimation=void 0,this._gl=void 0,this._pointer=void 0,this._isRendering=!1,this.lastRenderingTime=0,this.textures=void 0,this.buffers=void 0,this.programs=void 0,this.camera=new Bt,this.render=function(t){if(n._isRendering){window.requestAnimationFrame(n.render);var e=n.gl,r=n.lastRenderingTime;if(n.lastRenderingTime=t,0!==r){!function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e<=0?window.devicePixelRatio:e,r=t.canvas;if(r instanceof HTMLCanvasElement){var a=Math.floor(r.clientWidth*n),i=Math.floor(r.clientHeight*n);if(r.width!==a||r.height!==i)return r.width=a,r.height=i,t.viewport(0,0,a,i),!0}}(e,n.resolution),e.clearDepth(1),e.clear(e.DEPTH_BUFFER_BIT),e.depthFunc(e.LESS),e.disable(e.DEPTH_TEST);try{var a=n.onAnimation;if("function"===typeof a)a(t,e.drawingBufferWidth,e.drawingBufferHeight),n.pointer.reset()}catch(i){n._isRendering=!1,console.error("##################################"),console.error("# Rendering   has  been  stopped #"),console.error("# because of the following error #"),console.error("##################################"),console.error(i)}}}},this._pointer=new d(e);var r=e.getContext("webgl2",{});if(r||(console.warn("WebGL2 is not available! Switching to WebGL."),r=e.getContext("webgl",{})),!r)throw new Error("Unable to create a WegGL context!");this._gl=r,this.textures=new L(r),this.buffers=new Ot(r),this.programs=new Et(r)}return Object(u.a)(t,[{key:"refresh",value:function(){var t=this._isRendering,e=this.lastRenderingTime;this._isRendering=!0;var n=Date.now();this.lastRenderingTime=n-15,this.render(n),this._isRendering=t,this.lastRenderingTime=e}},{key:"isRendering",get:function(){return this._isRendering},set:function(t){t!==this._isRendering&&(this._isRendering=t,t&&window.requestAnimationFrame(this.render))}},{key:"gl",get:function(){return this._gl}},{key:"pointer",get:function(){return this._pointer}},{key:"width",get:function(){return this._gl.drawingBufferWidth}},{key:"height",get:function(){return this._gl.drawingBufferHeight}}]),t}(),zt=(n(61),function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))).refCanvas=i.a.createRef(),t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=Object(v.a)(m.a.mark((function t(){var e,n,r,a,i,o,s,c,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.refCanvas.current){t.next=3;break}return t.abrupt("return");case 3:return(n=new Xt(e)).camera=new Bt,t.next=7,this.props.painter(n);case 7:r=t.sent,a=n.gl,i=this.props.dis||4,o=Ct.deg2rad(this.props.lat||15),s=this.props.x||0,c=this.props.y||0,u=this.props.z||0,n.onAnimation=function(t){a.clearColor(0,0,0,0),a.clearDepth(1),a.depthFunc(a.LESS),a.enable(a.DEPTH_TEST),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var e=.001*t;n.camera.orbit(s,c,u,i,o,e),r.paint(t)},n.isRendering=!0,"function"===typeof this.props.onLoad&&this.props.onLoad();case 17:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=["app-view-Preview"].concat(Object(l.a)(r.a.Converter.StringArray(this.props.className,[]))),e=this.props,n=e.name,a=e.type;return i.a.createElement("div",{className:t.join(" ")},i.a.createElement("canvas",{ref:this.refCanvas}),n&&i.a.createElement("div",{className:"name"},n),a&&i.a.createElement("div",{className:"type"},a))}}]),n}(i.a.Component)),Gt=function t(){Object(c.a)(this,t)},Yt=function(){function t(e,n){Object(c.a)(this,t),this.def=n,this.id=void 0,this.verticesCount=void 0,this.texturesCount=void 0,this.normalsCount=void 0,this.facesCount=void 0,this.id=e,this.verticesCount=Math.floor(n.vertices.length/3),this.texturesCount=Math.floor(n.textures.length/2),this.normalsCount=Math.floor(n.normals.length/3),this.facesCount=Math.floor(n.faces.length/9)}return Object(u.a)(t,[{key:"getVertexX",value:function(t){return Ht(t,this.verticesCount),this.def.vertices[3*t+0]}},{key:"getVertexY",value:function(t){return Ht(t,this.verticesCount),this.def.vertices[3*t+1]}},{key:"getVertexZ",value:function(t){return Ht(t,this.verticesCount),this.def.vertices[3*t+2]}},{key:"getTextureU",value:function(t){return Ht(t,this.texturesCount),this.def.textures[2*t+0]}},{key:"getTextureV",value:function(t){return Ht(t,this.texturesCount),this.def.textures[2*t+1]}},{key:"getNormalX",value:function(t){return Ht(t,this.normalsCount),this.def.normals[3*t+0]}},{key:"getNormalY",value:function(t){return Ht(t,this.normalsCount),this.def.normals[3*t+1]}},{key:"getNormalZ",value:function(t){return Ht(t,this.normalsCount),this.def.normals[3*t+2]}},{key:"getFaceSmoothness",value:function(t){return Ht(t,this.facesCount),"1"===this.def.smoothness.charAt(t)}},{key:"getFaceVertex",value:function(t,e){Ht(t,this.facesCount);var n=9*t+3*e+0;return this.def.faces[n]}},{key:"getFaceTexture",value:function(t,e){Ht(t,this.facesCount);var n=9*t+3*e+1;return this.def.faces[n]}},{key:"getFaceNormal",value:function(t,e){Ht(t,this.facesCount);var n=9*t+3*e+2;return this.def.faces[n]}}]),t}();function Ht(t,e){if(t<0||t>=e)throw"Index ".concat(t," is out of range [0..").concat(e-1,"]!")}var Wt=new A,Zt={createOrGetFromCacheMeshDefinition:function(t){return qt.apply(this,arguments)}};function qt(){return(qt=Object(v.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e,t.abrupt("return",Wt.addAsync(e,Object(v.a)(m.a.mark((function t(){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.loadJson(e);case 2:return r=t.sent,t.abrupt("return",new Yt(n,r));case 4:case"end":return t.stop()}}),t)})))));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}new Float32Array([0,1,0]);var Jt=function t(e){Object(c.a)(this,t),this.location=Ct.vector.createVec3(),this.transfo=void 0,this.transfo=e},Kt=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t.transfo)).params=t,r}return Object(u.a)(n,[{key:"paint",value:function(t){var e=this.params,n=e.scene,r=e.arrayBuffer,a=e.colorTexture,i=e.program,o=e.attributesCount,s=n.gl,c=n.camera;s.enable(s.CULL_FACE),s.cullFace(s.BACK),i.use(),c.setUniformValues(i,n.width,n.height,t),a.attachToUnit(0),i.uniforms.set("uniObjectTransfo",this.transfo.value),i.uniforms.set("uniTexture",0),i.bindAttribs(r.buffer),s.drawArrays(s.TRIANGLES,0,o)}},{key:"destroy",value:function(){var t=this.params,e=t.arrayBuffer,n=t.colorTexture;e.destroy(),n.destroy()}},{key:"program",get:function(){return this.params.program}}]),n}(Jt),Qt=n(20),$t=n.n(Qt),te=n(21),ee=n.n(te),ne={createAsync:function(t,e){return re.apply(this,arguments)}};function re(){return(re=Object(v.a)(m.a.mark((function t(e,n){var r,a,i,o,s,c,u,f,h,l,p;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.scene,a=n.definitionURL,i=n.colorTextureURL,o=r.camera,s="[FRESNEL]:".concat(a),t.next=5,Zt.createOrGetFromCacheMeshDefinition(a);case 5:return c=t.sent,u=oe(c),f=Math.floor(u.length/8),h=r.buffers.createArrayBuffer(s,u),t.next=11,r.textures.createImageTextureAsync({url:i,linear:!1});case 11:return l=t.sent,t.next=14,ae(r,o);case 14:return p=t.sent,t.abrupt("return",new Kt({scene:n.scene,transfo:e,arrayBuffer:h,attributesCount:f,colorTexture:l,program:p}));case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ae(t,e){return ie.apply(this,arguments)}function ie(){return(ie=Object(v.a)(m.a.mark((function t(e,n){var r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="[FRESNEL]:".concat(n.id),t.next=3,e.programs.createProgramAsync(r,{uniforms:{uniObjectTransfo:"mat4"},attributes:{attLocation:"vec3",attUV:"vec2",attNormal:"vec3"},varyings:{varNormal:"vec3",varReflexion:"vec3",varUV:"vec2"},functions:{main:$t.a},dependencies:[n.vertexShader]},{uniforms:{uniTexture:"sampler2D"},functions:{main:ee.a}});case 3:return a=t.sent,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function oe(t){for(var e=[],n=0;n<t.facesCount;n++)for(var r=0;r<3;r++){var a=t.getFaceVertex(n,r);e.push(t.getVertexX(a),t.getVertexY(a),t.getVertexZ(a));var i=t.getFaceTexture(n,r);e.push(t.getTextureU(i),t.getTextureV(i));var o=t.getFaceNormal(n,r);e.push(t.getNormalX(o),t.getNormalY(o),t.getNormalZ(o))}return new Float32Array(e)}var se=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t.transfo)).params=t,r.color=new Float32Array([0,0,0,1]),r.thickness=2,console.info("params=",t),r}return Object(u.a)(n,[{key:"setRGB",value:function(t,e,n){var r=this.color;r[0]=t,r[1]=e,r[2]=n}},{key:"setRGBA",value:function(t,e,n,r){var a=this.color;a[0]=t,a[1]=e,a[2]=n,a[3]=r}},{key:"paint",value:function(t){var e=this.params,n=e.scene,r=e.arrayBuffer,a=e.program,i=e.attributesCount,o=n.gl,s=n.camera;o.enable(o.CULL_FACE),o.cullFace(o.FRONT),a.use(),s.setUniformValues(a,n.width,n.height,t),a.uniforms.set("uniColor",this.color),a.uniforms.set("uniThickness",.001*this.thickness),a.uniforms.set("uniObjectTransfo",this.transfo.value),a.bindAttribs(r.buffer),o.drawArrays(o.TRIANGLES,0,i)}},{key:"destroy",value:function(){this.params.arrayBuffer.destroy()}},{key:"program",get:function(){return this.params.program}}]),n}(Jt),ce=n(22),ue=n.n(ce),fe=n(23),he=n.n(fe),le={createAsync:function(t){return pe.apply(this,arguments)}};function pe(){return(pe=Object(v.a)(m.a.mark((function t(e){var n,r,a,i,o,s,c,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.scene,r=e.definitionURL,a="[OUTLINE]:".concat(r),t.next=4,Zt.createOrGetFromCacheMeshDefinition(r);case 4:return i=t.sent,o=de(i),s=Math.floor(o.length/6),c=n.buffers.createArrayBuffer(a,o),t.next=10,me(n);case 10:return u=t.sent,t.abrupt("return",new se({scene:n,transfo:e.transfo,arrayBuffer:c,attributesCount:s,program:u}));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function me(t){return ve.apply(this,arguments)}function ve(){return(ve=Object(v.a)(m.a.mark((function t(e){var n,r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.camera,r="[OUTLINE]:".concat(n.id),t.next=4,e.programs.createProgramAsync(r,{uniforms:{uniObjectTransfo:"mat4",uniThickness:"float"},attributes:{attLocation:"vec3",attNormal:"vec3"},functions:{main:ue.a},dependencies:[n.vertexShader]},{uniforms:{uniColor:"vec4"},functions:{main:he.a}});case 4:return a=t.sent,t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function de(t){for(var e=[],n=[],r=0;r<t.facesCount;r++)for(var a=0;a<3;a++){var i=t.getFaceVertex(r,a);n[i]||(n[i]=new ye(t.getVertexX(i),t.getVertexY(i),t.getVertexZ(i)));var o=n[i],s=t.getFaceNormal(r,a);o.addNormal(t.getNormalX(s),t.getNormalY(s),t.getNormalZ(s))}for(var c=0;c<t.facesCount;c++)for(var u=0;u<3;u++){var f=n[t.getFaceVertex(c,u)];e.push.apply(e,Object(l.a)(f.data))}return console.info("data=",e),new Float32Array(e)}var ye=function(){function t(e,n,r){Object(c.a)(this,t),this.x=e,this.y=n,this.z=r,this.normalX=0,this.normalY=0,this.normalZ=0,this.normalsCount=0}return Object(u.a)(t,[{key:"addNormal",value:function(t,e,n){this.normalX+=t,this.normalY+=e,this.normalZ+=n,this.normalsCount++}},{key:"data",get:function(){var t=Math.max(1,this.normalsCount),e=this.normalX/t,n=this.normalY/t,r=this.normalZ/t,a=1/Math.sqrt(e*e+n*n+r*r);return[this.x,this.y,this.z,e*a,n*a,r*a]}}]),t}(),ge={Fresnel:ne,Outline:le},be=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a)))._x=0,t._y=0,t._z=0,t._sx=1,t._sy=1,t._sz=1,t._lat=0,t._lng=0,t._dirty=!0,t}return Object(u.a)(n,[{key:"compute",value:function(){if(!this._dirty)return this.transfo;var t=this.x,e=this.y,n=this.z,r=this.sx,a=this.sy,i=this.sz,o=this.lat,s=this.lng,c=this.transfo,u=Ct.deg2rad(o),f=Ct.deg2rad(s),h=Math.cos(u),l=Math.sin(u),p=Math.cos(f),m=Math.sin(f);return c[Ct.M4_00]=r*p,c[Ct.M4_10]=0,c[Ct.M4_20]=-r*m,c[Ct.M4_30]=0,c[Ct.M4_01]=a*l*m,c[Ct.M4_11]=a*h,c[Ct.M4_21]=a*l*p,c[Ct.M4_31]=0,c[Ct.M4_02]=i*h*m,c[Ct.M4_12]=-i*l,c[Ct.M4_22]=i*h*p,c[Ct.M4_32]=0,c[Ct.M4_03]=t,c[Ct.M4_13]=e,c[Ct.M4_23]=n,c[Ct.M4_33]=1,this._dirty=!1,c}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._dirty=!0}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._dirty=!0}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._dirty=!0}},{key:"sx",get:function(){return this._sx},set:function(t){this._sx=t,this._dirty=!0}},{key:"sy",get:function(){return this._sy},set:function(t){this._sy=t,this._dirty=!0}},{key:"sz",get:function(){return this._sz},set:function(t){this._sz=t,this._dirty=!0}},{key:"lat",get:function(){return this._lat},set:function(t){this._lat=t,this._dirty=!0}},{key:"lng",get:function(){return this._lng},set:function(t){this._lng=t,this._dirty=!0}}]),n}(function(){function t(){Object(c.a)(this,t),this.parent=void 0,this.transfo=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.composedTransfo=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return Object(u.a)(t,[{key:"value",get:function(){var t=this.compute(),e=this.parent;return e?(Ct.matrix.multiply4(e.transfo,t,this.composedTransfo),this.composedTransfo):t}}]),t}()),Ee=function(){function t(e,n){Object(c.a)(this,t),this.body=e,this.outline=n,this.transfo=void 0;var r=this.body.transfo;if(!(r instanceof be))throw Error("Expected a PolarLocSca transfo!");this.transfo=r}return Object(u.a)(t,[{key:"paint",value:function(t){this.outline.paint(t),this.body.paint(t)}},{key:"color",get:function(){return this.outline.color}},{key:"thickness",get:function(){return this.outline.thickness},set:function(t){this.outline.thickness=t}}]),t}(),Te=function(t,e){return Object(v.a)(m.a.mark((function n(){var r,a,i;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new be,n.next=3,ge.Fresnel.createAsync(r,{colorTextureURL:"./assets/palette/default-64.png",definitionURL:e,scene:t});case 3:return a=n.sent,n.next=6,ge.Outline.createAsync({transfo:r,definitionURL:e,scene:t});case 6:return i=n.sent,n.abrupt("return",new Ee(a,i));case 8:case"end":return n.stop()}}),n)})))()},Oe={createAsync:function(t){return Object(v.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,"./assets/mesh/Golgoth.json");case 2:return n=e.sent,e.abrupt("return",new _e(n));case 4:case"end":return e.stop()}}),e)})))()}},_e=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Ae={createAsync:function(t){return Object(v.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,"./assets/mesh/Balzac.json");case 2:return n=e.sent,e.abrupt("return",new we(n));case 4:case"end":return e.stop()}}),e)})))()}},we=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),xe={createAsync:function(t){return Object(v.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,"./assets/mesh/Hydre.json");case 2:return n=e.sent,e.abrupt("return",new Me(n));case 4:case"end":return e.stop()}}),e)})))()}},Me=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),je={createAsync:function(t){return Object(v.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,"./assets/mesh/Tyson.json");case 2:return n=e.sent,e.abrupt("return",new ke(n));case 4:case"end":return e.stop()}}),e)})))()}},ke=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Le={createAsync:function(t){return Object(v.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,"./assets/mesh/Island-A.json");case 2:return n=e.sent,e.abrupt("return",new Fe(n));case 4:case"end":return e.stop()}}),e)})))()}},Fe=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Re={createAsync:function(t){return Object(v.a)(m.a.mark((function e(){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,"./assets/mesh/Stone.json");case 2:return n=e.sent,e.next=5,Te(t,"./assets/mesh/Helix.json");case 5:return r=e.sent,e.abrupt("return",new Ue(n,r));case 7:case"end":return e.stop()}}),e)})))()}},Ue=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t,r){var a;Object(c.a)(this,n),(a=e.call(this)).mainObject=t,a.helixObject=r,r.transfo.parent=t.transfo;return r.transfo.sx=3,r.transfo.sy=3,r.transfo.sz=3,r.transfo.y=-1,a}return Object(u.a)(n,[{key:"paint",value:function(t){this.helixObject.transfo.lng=.2*-t,this.mainObject.paint(t),this.helixObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Ce={createAsync:function(t){return Object(v.a)(m.a.mark((function e(){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,"./assets/mesh/Island-B.json");case 2:return n=e.sent,e.next=5,Te(t,"./assets/mesh/Helix.json");case 5:return r=e.sent,e.abrupt("return",new Ne(n,r));case 7:case"end":return e.stop()}}),e)})))()}},Ne=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t,r){var a;Object(c.a)(this,n),(a=e.call(this)).mainObject=t,a.helixObject=r,r.transfo.parent=t.transfo,r.transfo.y=10;return r.transfo.sx=6,r.transfo.sy=6,r.transfo.sz=6,a}return Object(u.a)(n,[{key:"paint",value:function(t){this.helixObject.transfo.lng=.1*-t,this.mainObject.paint(t),this.helixObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Se={createAsync:function(t){return Object(v.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,"./assets/mesh/Umbrella.json");case 2:return n=e.sent,e.abrupt("return",new De(n));case 4:case"end":return e.stop()}}),e)})))()}},De=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Pe=(n(62),r.a.Intl.make(n(63))),Ie=r.a.View.Button,Ve=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={page:0,golgoth:!1,balzac:!1,hydre:!1,tyson:!1,done:!1},t.handleLoad=function(e){switch(e){case"golgoth":t.setState({golgoth:!0},t.checkIsLoaded);break;case"balzac":t.setState({balzac:!0},t.checkIsLoaded);break;case"hydre":t.setState({hydre:!0},t.checkIsLoaded);break;case"tyson":t.setState({tyson:!0},t.checkIsLoaded);break;default:throw Error("Impossible!")}},t.checkIsLoaded=function(){t.state.golgoth&&t.state.balzac&&t.state.hydre&&t.state.tyson&&t.props.onLoad()},t.handleNextPage=function(){t.state.page>3&&(t.setState({done:!0}),window.setTimeout(t.props.onDone,500)),t.setState({page:t.state.page+1})},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=this;window.document.addEventListener("keyup",(function(e){"Escape"===e.key&&t.setState({page:666},t.handleNextPage)}))}},{key:"page",value:function(t){var e=this.state.page;return e===t?"in":e>t?"out":""}},{key:"render",value:function(){var t=this,e=["app-Intro"];return this.state.done&&e.push("hide"),i.a.createElement("div",{className:e.join(" ")},i.a.createElement(zt,{y:1,className:"golgoth",painter:Oe.createAsync,name:"golgoth",type:Pe("type-golgoth"),onLoad:function(){return t.handleLoad("golgoth")}}),i.a.createElement(zt,{y:1,className:"balzac",painter:Ae.createAsync,name:"balzac",type:Pe("type-balzac"),onLoad:function(){return t.handleLoad("balzac")}}),i.a.createElement(zt,{y:0,className:"hydre",painter:xe.createAsync,name:"hydre",type:Pe("type-hydre"),onLoad:function(){return t.handleLoad("hydre")}}),i.a.createElement(zt,{y:1,className:"tyson",painter:je.createAsync,name:"tyson",type:Pe("type-tyson"),onLoad:function(){return t.handleLoad("tyson")}}),i.a.createElement("div",{className:"story"},i.a.createElement("section",{className:this.page(0)},i.a.createElement("p",null,Pe("story1")),i.a.createElement(zt,{className:"small-canvas",dis:42,lat:45,painter:Le.createAsync}),i.a.createElement(Ie,{icon:"right",warning:!0,onClick:this.handleNextPage})),i.a.createElement("section",{className:this.page(1)},i.a.createElement("p",null,Pe("story2a")),i.a.createElement("div",{className:"big"},"17''"),i.a.createElement("p",null,Pe("story2b")),i.a.createElement(Ie,{icon:"right",warning:!0,onClick:this.handleNextPage})),i.a.createElement("section",{className:this.page(2)},i.a.createElement("p",null,Pe("story3")),i.a.createElement(zt,{className:"small-canvas",dis:38,lat:45,painter:Ce.createAsync}),i.a.createElement(Ie,{icon:"right",warning:!0,onClick:this.handleNextPage})),i.a.createElement("section",{className:this.page(3)},i.a.createElement("p",null,Pe("story4")),i.a.createElement(zt,{className:"small-canvas",dis:20,lat:40,y:4,painter:Re.createAsync}),i.a.createElement(Ie,{icon:"right",warning:!0,onClick:this.handleNextPage})),i.a.createElement("section",{className:this.page(4)},i.a.createElement("p",null,Pe("story5")),i.a.createElement(zt,{className:"small-canvas",dis:10,lat:20,y:0,painter:Se.createAsync}),i.a.createElement(Ie,{icon:"right",warning:!0,onClick:this.handleNextPage}))))}}]),n}(i.a.Component);n(64);r.a.Font.loadJosefin(),r.a.Font.loadMysteryQuest();var Be=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).handleStart=function(){},t}return Object(u.a)(n,[{key:"render",value:function(){var t=["App","thm-bg0"];return this.props.className&&t.push(this.props.className),i.a.createElement("div",{className:t.join(" ")},i.a.createElement(Ve,{onLoad:Xe,onDone:this.handleStart}))}}]),n}(i.a.Component);function Xe(){var t=document.getElementById("splash");t&&(t.classList.add("hide"),window.setTimeout((function(){var e=t.parentNode;e&&e.removeChild(t)}),1e3))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.Theme.register("default",{bg0:"#222",bg3:"#555"}),r.a.Theme.apply("default"),r.a.Font.loadJosefin(),s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(Be,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[24,1,2]]]);
//# sourceMappingURL=main.578c9956.chunk.js.map