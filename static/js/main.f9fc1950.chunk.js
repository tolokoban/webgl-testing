(this["webpackJsonpwebgl-testing"]=this["webpackJsonpwebgl-testing"]||[]).push([[0],{19:function(t,e,n){t.exports=n.p+"static/media/perspective.world-point-to-screen.34658b6e.vert"},20:function(t,e,n){t.exports=n.p+"static/media/perspective.world-vector-to-screen.79a1763d.vert"},21:function(t,e,n){t.exports=n.p+"static/media/main.a91ec25c.vert"},22:function(t,e,n){t.exports=n.p+"static/media/main.a27a283f.frag"},23:function(t,e,n){t.exports=n.p+"static/media/main.d0ebbab8.vert"},24:function(t,e,n){t.exports=n.p+"static/media/main.cb7cba22.frag"},25:function(t,e,n){t.exports=n.p+"static/media/main.68b24702.vert"},26:function(t,e,n){t.exports=n.p+"static/media/main.ebbb337c.frag"},27:function(t,e,n){t.exports=n.p+"static/media/main.f9be4724.vert"},28:function(t,e,n){t.exports=n.p+"static/media/main.727c4dcd.frag"},29:function(t,e,n){t.exports=n(73)},64:function(t,e,n){},66:function(t,e,n){},67:function(t,e,n){},68:function(t){t.exports=JSON.parse('{"en":{"type-balzac":"Slow (5\')","type-golgoth":"Very Slow (10\')","type-hydre":"Fast (2\')","type-tyson":"Very Fast (1\')"},"fr":{"story1":"Les habitants de l\'\xeele flottante VOLCANO sont en danger!","story2a":"VOLCANO va cesser de flotter dans...","story2b":"Et tomber dans le n\xe9ant !","story3":"Il faut les aider \xe0 rejoindre l\'\xeele flottante MOLINO.","story4":"Pour cela, ils devront sauter sur un rocher pluvieux sur lequel il n\'y a de la place que pour 2.","story5":"Il leur faudra donc utiliser l\'unique parapluie pour ne pas se mouiller.","type-balzac":"Lent (5\')","type-golgoth":"Tr\xe8s Lent (10\')","type-hydre":"Rapide (2\')","type-tyson":"Tr\xe8s Rapide (1\')"}}')},69:function(t,e,n){},70:function(t,e,n){},71:function(t,e,n){t.exports=n.p+"static/media/controls.b6ff455b.yaml"},72:function(t,e,n){},73:function(t,e,n){"use strict";n.r(e);var r=n(7),a=n(0),i=n.n(a),s=n(15),o=n.n(s),c=(n(64),n(2)),u=n(3),f=n(6),h=n(5),l=n(9),p=n(1),m=n.n(p),v=n(4),d=function(){function t(e){var n=this;Object(c.a)(this,t),this._x=0,this._y=0,this._down=!1,this._downTime=0,this._eventDown=!1,this._eventUp=!1,this.canvas=void 0,this.onMouseMove=function(t){n.computeCoords(t.clientX,t.clientY)},this.onTouchMove=function(t){var e=t.touches[0];n.computeCoords(e.clientX,e.clientY)},this.onMouseDown=function(t){n.onDown(t.clientX,t.clientY)},this.onTouchStart=function(t){var e=t.touches[0];n.onDown(e.clientX,e.clientY)},this.onMouseUp=function(t){n.onUp(t.clientX,t.clientY)},this.onTouchEnd=function(t){var e=t.touches[0];n.onUp(e.clientX,e.clientY)},this.canvas=e,window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mousedown",this.onMouseDown,!0),window.addEventListener("touchstart",this.onTouchStart,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("touchend",this.onTouchEnd,!0)}return Object(u.a)(t,[{key:"reset",value:function(){this._eventDown=!1,this._eventUp=!1}},{key:"onDown",value:function(t,e){0===this._downTime&&(this.computeCoords(t,e),this._down=!0,this._eventDown=!0,this._downTime=Date.now())}},{key:"onUp",value:function(t,e){0!==this._downTime&&(this.computeCoords(t,e),this._down=!1,this._eventUp=!0,this._downTime=0)}},{key:"computeCoords",value:function(t,e){var n=this.canvas.getBoundingClientRect(),r=t-n.left,a=e-n.top,i=n.width,s=n.height;this._x=2*(r/i-.5),this._y=2*(a/s-.5)}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"down",get:function(){return this._down}},{key:"eventUp",get:function(){return this._eventUp}},{key:"eventDown",get:function(){return this._eventDown}}]),t}(),y={loadImage:function(t){return new Promise((function(e,n){var r=new Image;r.onload=function(){return e(r)},r.onerror=function(){console.error("Unable to load image from URL:",t),n(t)},r.src=t}))},loadJson:function(t){return T.apply(this,arguments)},loadText:b};function b(t){return g.apply(this,arguments)}function g(){return(g=Object(v.a)(m.a.mark((function t(e){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:return n=t.sent,t.next=6,n.text();case 6:return r=t.sent,t.abrupt("return",r);case 10:throw t.prev=10,t.t0=t.catch(0),console.error("Unable to load text from URL:",e),console.error(t.t0),t.t0;case 15:case"end":return t.stop()}}),t,null,[[0,10]])})))).apply(this,arguments)}function T(){return(T=Object(v.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(e);case 2:return n=t.sent,t.prev=3,t.abrupt("return",JSON.parse(n));case 7:throw t.prev=7,t.t0=t.catch(3),console.error("Unable to parse JSON:",e),console.error(t.t0),t.t0;case 12:case"end":return t.stop()}}),t,null,[[3,7]])})))).apply(this,arguments)}var E=function(){function t(e,n,r){Object(c.a)(this,t),this.gl=e,this.id=n,this.texture=void 0,this.target=void 0,this.units=void 0;var a=e.createTexture();if(!a)throw Error('[FlatLand] Unable to create texture "'.concat(n,'"!'));switch(this.texture=a,r){case"2d":this.target=e.TEXTURE_2D;break;case"cubeMap":this.target=e.TEXTURE_CUBE_MAP;break;default:throw Error('[FlatLand.Texture] Unknow target "'.concat(r,'"! Available targets are "2d", "cubeMap", "3d" and "2dArray".'))}this.units=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7,e.TEXTURE8,e.TEXTURE9,e.TEXTURE10,e.TEXTURE11,e.TEXTURE12,e.TEXTURE13,e.TEXTURE14,e.TEXTURE15]}return Object(u.a)(t,[{key:"attachToUnit",value:function(t){var e=this.gl,n=this.texture,r=this.target,a=this.units;if(t<0)throw Error("[FlatLand.Texture.attachToUnit] unitIndex must be positive!");if(t>a.length-1)throw Error("[FlatLand.Texture.attachToUnit] unitIndex must be lower than ".concat(a.length,"!"));e.activeTexture(a[t]),e.bindTexture(r,n)}}]),t}(),O=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;Object(c.a)(this,n),(r=e.call(this,t.gl,t.id,"2d")).params=t;var a=t.gl,i=t.linear?a.LINEAR:a.NEAREST;return a.bindTexture(a.TEXTURE_2D,r.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.source),r}return Object(u.a)(n,[{key:"update",value:function(t){var e=this.params.gl;e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}},{key:"destroy",value:function(){return!!this.params.confirmDestroy()&&(this.params.gl.deleteTexture(this.texture),!0)}},{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}}]),n}(E),_=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;Object(c.a)(this,n),(r=e.call(this,t.gl,t.id,"cubeMap")).params=t;var a=t.gl;return a.bindTexture(a.TEXTURE_CUBE_MAP,r.texture),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosX),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegX),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosY),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegY),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosZ),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegZ),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a instanceof WebGL2RenderingContext&&a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_R,a.CLAMP_TO_EDGE),a.generateMipmap(a.TEXTURE_CUBE_MAP),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),r}return Object(u.a)(n,[{key:"destroy",value:function(){return!!this.params.confirmDestroy()&&(this.params.gl.deleteTexture(this.texture),!0)}}]),n}(E),A=function(){function t(){Object(c.a)(this,t),this.lockedIds=new Set,this.map=new Map}return Object(u.a)(t,[{key:"lockAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=100,r=this.lockedIds;case 2:if(!r.has(e)){t.next=7;break}return t.next=5,w(n);case 5:t.next=2;break;case 7:r.add(e);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"unlock",value:function(t){this.lockedIds.delete(t)}},{key:"addAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e,n){var r,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.lockAsync(e);case 2:if(t.prev=2,!(r=this.map).has(e)){t.next=10;break}if(a=r.get(e)){t.next=8;break}throw Error("Impossible error on map!");case 8:return a.count++,t.abrupt("return",a.value);case 10:return t.next=12,n();case 12:return i=t.sent,r.set(e,{count:1,value:i}),t.abrupt("return",i);case 15:return t.prev=15,this.unlock(e),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[2,,15,18]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"add",value:function(t,e){var n=this.map;if(n.has(t)){var r=n.get(t);if(!r)throw Error("Impossible error on map!");return r.count++,r.value}var a=e();return n.set(t,{count:1,value:a}),a}},{key:"remove",value:function(t){var e=this.map.get(t);return e?(e.count--,e.count<=0&&this.map.delete(t),e.count):-1}}]),t}();function w(t){return x.apply(this,arguments)}function x(){return(x=Object(v.a)(m.a.mark((function t(e){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return window.setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var j,M,k,L=function(){function t(e){Object(c.a)(this,t),this.gl=e,this.imageTexturesMap=new A,this.cubeMapTexturesMap=new A}return Object(u.a)(t,[{key:"createImageTextureAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.imageTexturesMap.addAsync(e.url,Object(v.a)(m.a.mark((function t(){var r,a,i,s,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.gl,a=e.url,i=e.linear,t.next=4,y.loadImage(a);case 4:return s=t.sent,o=new O({id:a,gl:r,source:s,width:s.width,height:s.height,linear:i,confirmDestroy:function(){return 0===n.imageTexturesMap.remove(a)}}),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createCubeMapTextureAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.cubeMapTexturesMap.addAsync(e,Object(v.a)(m.a.mark((function t(){var r,a,i,s,o,c,u,f,h;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.gl,a=e.split("?"),t.next=4,y.loadImage(a.join("1"));case 4:return i=t.sent,t.next=7,y.loadImage(a.join("2"));case 7:return s=t.sent,t.next=10,y.loadImage(a.join("3"));case 10:return o=t.sent,t.next=13,y.loadImage(a.join("4"));case 13:return c=t.sent,t.next=16,y.loadImage(a.join("5"));case 16:return u=t.sent,t.next=19,y.loadImage(a.join("6"));case 19:return f=t.sent,h=new _({gl:r,id:e,sourcePosX:i,sourceNegX:s,sourcePosY:o,sourceNegY:c,sourcePosZ:u,sourceNegZ:f,confirmDestroy:function(){return 0===n.cubeMapTexturesMap.remove(e)}}),t.abrupt("return",h);case 22:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),R=n(10),F=n(8),C=n(12);!function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4"}(j||(j={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4",t[t.FLOAT_MAT2=4]="FLOAT_MAT2",t[t.FLOAT_MAT3=5]="FLOAT_MAT3",t[t.FLOAT_MAT4=6]="FLOAT_MAT4",t[t.BYTE=7]="BYTE",t[t.UNSIGNED_BYTE=8]="UNSIGNED_BYTE",t[t.SHORT=9]="SHORT",t[t.UNSIGNED_SHORT=10]="UNSIGNED_SHORT",t[t.INT=11]="INT",t[t.UNSIGNED_INT=12]="UNSIGNED_INT",t[t.BOOL=13]="BOOL",t[t.SAMPLER_2D=14]="SAMPLER_2D",t[t.SAMPLER_CUBE=15]="SAMPLER_CUBE"}(M||(M={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4",t[t.FLOAT_MAT2=4]="FLOAT_MAT2",t[t.FLOAT_MAT3=5]="FLOAT_MAT3",t[t.FLOAT_MAT4=6]="FLOAT_MAT4"}(k||(k={}));var U={getAttributeSize:function(t){switch(t){case j.FLOAT_VEC2:return 2;case j.FLOAT_VEC3:return 3;case j.FLOAT_VEC4:return 4;default:return 1}},getAttributeTypeCodeName:function(t){return N.get(t)},getUniformTypeCodeName:function(t){return D.get(t)},getVaryingTypeCodeName:function(t){return S.get(t)},getWebGLTypeFromAttributeType:function(t,e){switch(e){case j.FLOAT_VEC2:return t.FLOAT_VEC2;case j.FLOAT_VEC3:return t.FLOAT_VEC3;case j.FLOAT_VEC4:return t.FLOAT_VEC4;default:return t.FLOAT}}};var N=new Map;N.set(j.FLOAT,"float"),N.set(j.FLOAT_VEC2,"vec2"),N.set(j.FLOAT_VEC3,"vec3"),N.set(j.FLOAT_VEC4,"vec4");var S=new Map;S.set(k.FLOAT,"float"),S.set(k.FLOAT_VEC2,"vec2"),S.set(k.FLOAT_VEC3,"vec3"),S.set(k.FLOAT_VEC4,"vec4"),S.set(k.FLOAT_MAT2,"mat2"),S.set(k.FLOAT_MAT3,"mat3"),S.set(k.FLOAT_MAT4,"mat4");var D=new Map;D.set(M.BOOL,"bool"),D.set(M.BYTE,"int"),D.set(M.SHORT,"int"),D.set(M.INT,"int"),D.set(M.UNSIGNED_BYTE,"uint"),D.set(M.UNSIGNED_SHORT,"uint"),D.set(M.UNSIGNED_INT,"uint"),D.set(M.SAMPLER_2D,"sampler2D"),D.set(M.SAMPLER_CUBE,"samplerCube"),D.set(M.FLOAT,"float"),D.set(M.FLOAT_VEC2,"vec2"),D.set(M.FLOAT_VEC3,"vec3"),D.set(M.FLOAT_VEC4,"vec4"),D.set(M.FLOAT_MAT2,"mat2"),D.set(M.FLOAT_MAT3,"mat3"),D.set(M.FLOAT_MAT4,"mat4");var P=function(){function t(e,n,r){Object(c.a)(this,t),this.uniformsDefinition=r,this.uniformSetters=new Map,this.attachProgram(e,n)}return Object(u.a)(t,[{key:"set",value:function(t,e){var n=this.uniformSetters.get(t);n&&n(e)}},{key:"exists",value:function(t){return this.uniformSetters.has(t)}},{key:"attachProgram",value:function(t,e){for(var n=0,r=Object.keys(this.uniformsDefinition);n<r.length;n++){var a=r[n];if(t.getUniformLocation(e,a)){var i=this.uniformsDefinition[a],s=!!(i.size&&i.size>1);switch(i.type){case M.BYTE:case M.UNSIGNED_BYTE:case M.SHORT:case M.UNSIGNED_SHORT:case M.INT:case M.UNSIGNED_INT:case M.SAMPLER_2D:case M.SAMPLER_CUBE:this.attachProgramInt(t,e,a,s);break;case M.FLOAT:this.attachProgramFloat(t,e,a,s);break;case M.FLOAT_VEC2:this.attachProgramVec2(t,e,a,s);break;case M.FLOAT_VEC3:this.attachProgramVec3(t,e,a,s);break;case M.FLOAT_VEC4:this.attachProgramVec4(t,e,a,s);break;case M.FLOAT_MAT2:this.attachProgramMat2(t,e,a,s);break;case M.FLOAT_MAT3:this.attachProgramMat3(t,e,a,s);break;case M.FLOAT_MAT4:this.attachProgramMat4(t,e,a,s);break;default:throw Error('[AbstractShader.attachProgram] Unknown type for uniform "'.concat(a,'": ').concat(i.type,"[").concat(i.size||1,"]!"))}}else I(a)}}},{key:"attachProgramInt",value:function(t,e,n,r){var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,r?function(e){return t.uniform1iv(a,e)}:function(e){return t.uniform1i(a,e)})}},{key:"attachProgramFloat",value:function(t,e,n,r){var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,r?function(e){return t.uniform1fv(a,e)}:function(e){return t.uniform1f(a,e)})}},{key:"attachProgramVec2",value:function(t,e,n,r){if(r)throw Error("You cannot use array of vec2!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniform2fv(a,e)}))}},{key:"attachProgramVec3",value:function(t,e,n,r){if(r)throw Error("You cannot use array of vec3!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniform3fv(a,e)}))}},{key:"attachProgramVec4",value:function(t,e,n,r){if(r)throw Error("You cannot use array of vec4!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniform4fv(a,e)}))}},{key:"attachProgramMat2",value:function(t,e,n,r){if(r)throw Error("You cannot use array of mat2!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniformMatrix2fv(a,!1,e)}))}},{key:"attachProgramMat3",value:function(t,e,n,r){if(r)throw Error("You cannot use array of mat3!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniformMatrix3fv(a,!1,e)}))}},{key:"attachProgramMat4",value:function(t,e,n,r){if(r)throw Error("You cannot use array of mat4!");var a=t.getUniformLocation(e,n);this.uniformSetters.set(n,(function(e){return t.uniformMatrix4fv(a,!1,e)}))}}]),t}();function I(t){console.warn('Uniform "'.concat(t,'" has not been compiled in this program!')),console.warn("Shader compilation removes everything that is not used by the code.")}var B=Float32Array.BYTES_PER_ELEMENT,V=function(){function t(e,n,r){Object(c.a)(this,t),this.gl=e,this.prg=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=[],this.uniformSetters=void 0,this.vertexShader=n,this.fragmentShader=r}return Object(u.a)(t,[{key:"bindAttribs",value:function(t){var e=this.gl,n=this.prg,r=this.attributes;if(!n)throw Error("This program has not been attached yet!");e.bindBuffer(e.ARRAY_BUFFER,t);var a,i=Object(C.a)(r);try{for(i.s();!(a=i.n()).done;){var s=a.value;e.enableVertexAttribArray(s.location),e.vertexAttribPointer(s.location,s.size,e.FLOAT,s.normalization,s.totalSize,s.offset)}}catch(o){i.e(o)}finally{i.f()}}},{key:"attach",value:function(){var t=Object(v.a)(m.a.mark((function t(){var e,n,r,a,i,s,o,c;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.prg&&this.detach(),e=et(this.vertexShader),(n=et(this.fragmentShader)).attributes={},n.varyings=Object(F.a)(Object(F.a)({},e.varyings),n.varyings),t.next=7,Y(e);case 7:return r=t.sent,t.next=10,W(n);case 10:if(a=t.sent,i=this.gl,s=X(i,r),o=z(i,a),c=i.createProgram()){t.next=17;break}throw Error("Unable to create a new WebGLProgram!");case 17:this.prg=c,i.attachShader(c,s),i.attachShader(c,o),i.linkProgram(c),this.prepareUniformsForFastBinding(e.attributes),this.uniformSetters=new P(this.gl,this.prg,Object(F.a)(Object(F.a)({},e.uniforms),n.uniforms));case 23:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"detach",value:function(){var t=this.prg,e=this.gl;t&&(e.deleteProgram(t),delete this.prg)}},{key:"prepareUniformsForFastBinding",value:function(t){var e=this.gl,n=this.prg;if(!n)throw Error("This program has not been attached yet!");for(var r=[],a=0,i=0,s=Object.keys(t);i<s.length;i++){var o=s[i],c=t[o],u={location:e.getAttribLocation(n,o),offset:a,normalization:!1,size:U.getAttributeSize(c),totalSize:0,type:U.getWebGLTypeFromAttributeType(e,c)};r.push(u),a+=u.size*B}for(var f=a,h=0,l=r;h<l.length;h++){l[h].totalSize=f}this.attributes=r}},{key:"use",value:function(){var t=this.prg,e=this.gl;if(!t)throw Error("This program has not been attached yet!");e.useProgram(t)}},{key:"uniforms",get:function(){var t=this.uniformSetters;if(!t)throw Error("Can't get uniforms because the program has not been attached yet!\nprg.attach()");return t}}]),t}();function X(t,e){return G(t.VERTEX_SHADER,t,e)}function z(t,e){return G(t.FRAGMENT_SHADER,t,e)}function G(t,e,n){if(t!==e.VERTEX_SHADER&&t!==e.FRAGMENT_SHADER)throw Error("Type must be VERTEX_SHADER or FRAGMENT_SHADER!");var r=e.createShader(t);if(!r)throw Error("Unable to create a ".concat(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT"," shader!"));if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(r)||"NULL";throw console.error("An error occurred compiling the shader with the following code:"),console.info(function(t){var e,n=[],r=t.split("\n"),a=0,i=Object(C.a)(r);try{for(i.s();!(e=i.n()).done;){var s=e.value;a++,n.push("".concat(st(a)," | ").concat(s))}}catch(o){i.e(o)}finally{i.f()}return n.join("\n")}(n)),console.error("Here is the error: ".concat(a)),console.info(function(t,e){var n=t.split(/\n\r?/);n.unshift(""),tt.lastIndex=-1;var r=tt.exec(e);if(!r)return t;for(var a=Object(R.a)(r,3)[2],i=Number(a),s=Math.max(1,i-2),o=Math.min(n.length-1,i+2),c=["Here is an extract of the shader code:"],u=s;u<=o;u++)c.push("| ".concat(u,":    ").concat(n[u]));return c.join("\n")}(n,a)),Error("Unable to create a ".concat(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT"," shader!"))}return r}function Y(t){return H.apply(this,arguments)}function H(){return(H=Object(v.a)(m.a.mark((function t(e){var n,r,a,i,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],(r=q(e.uniforms))&&n.push(r),(a=K(e.attributes))&&n.push(a),(i=J(e.varyings))&&n.push(i),t.next=9,Q(e.functions);case 9:return s=t.sent,n.push(s),t.abrupt("return",n.join("\n"));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function W(t){return Z.apply(this,arguments)}function Z(){return(Z=Object(v.a)(m.a.mark((function t(e){var n,r,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=["precision mediump float;"],(r=q(e.uniforms))&&n.push(r),(a=J(e.varyings))&&n.push(a),t.next=7,Q(e.functions);case 7:return i=t.sent,n.push(i),t.abrupt("return",n.join("\n"));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function q(t){return Object.keys(t).map((function(e){var n=t[e],r=U.getUniformTypeCodeName(n.type);if(!r)throw Error('Unknown type for uniform "'.concat(e,'": ').concat(n,"!"));var a=(n.size||0)>1?"[".concat(n.size,"]"):"";return"uniform ".concat(r," ").concat(e).concat(a,";")})).join("\n")}function J(t){return Object.keys(t).map((function(e){var n=t[e],r=U.getVaryingTypeCodeName(n.type);if(!r)throw Error('Unknown type for varying "'.concat(e,'": ').concat(n,"!"));var a=(n.size||0)>1?"[".concat(n.size,"]"):"";return"varying ".concat(r," ").concat(e).concat(a,";")})).join("\n")}function K(t){return Object.keys(t).map((function(e){var n=t[e],r=U.getAttributeTypeCodeName(n);if(!r)throw Error('Unknown type for attribute "'.concat(e,'": ').concat(n,"!"));return"attribute ".concat(r," ").concat(e,";")})).join("\n")}function Q(t){return $.apply(this,arguments)}function $(){return($=Object(v.a)(m.a.mark((function t(e){var n,r,a,i,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=Object.keys(e);case 2:if(!(r.length>0)){t.next=17;break}if(a=r.pop()){t.next=6;break}return t.abrupt("break",17);case 6:if(i=e[a],!Array.isArray(i)){t.next=11;break}n.push.apply(n,Object(l.a)(i)),t.next=15;break;case 11:return t.next=13,y.loadText(i);case 13:s=t.sent,n.push(s);case 15:t.next=2;break;case 17:return t.abrupt("return",n.join("\n"));case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var tt=/ERROR: ([0-9]+):([0-9]+):/g;function et(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{var n={attributes:Object(F.a)({},t.attributesDefinition),functions:Object(F.a)({},t.functionsDefinition),uniforms:Object(F.a)({},t.uniformsDefinition),varyings:Object(F.a)({},t.varyingsDefinition)};if(0===e.length&&"undefined"===typeof n.functions.main)throw Error("A shader must have a 'void main()' function!");e.push(t);var r,a=Object(C.a)(t.dependenciesDefinition);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(-1===e.indexOf(i)){var s={attributes:Object(F.a)({},i.attributesDefinition),functions:Object(F.a)({},i.functionsDefinition),uniforms:Object(F.a)({},i.uniformsDefinition),varyings:Object(F.a)({},i.varyingsDefinition)};delete s.functions.main,rt(n.attributes,s.attributes),at(n.uniforms,s.uniforms),it(n.varyings,s.varyings),nt(n.functions,s.functions)}}}catch(o){a.e(o)}finally{a.f()}return n}catch(c){throw Error("Error in ".concat(t.constructor.name,":\n").concat(c))}}function nt(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=t[a],s=e[a];i||(t[a]=s)}}function rt(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=t[a],s=e[a];if(i){if(i!==s)throw Error('Attribute "'.concat(a,'" is redeclared in a dependency, but with a different type!'))}else t[a]=s}}function at(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=t[a],s=e[a];if(i){if(i.type!==s.type)throw Error('Uniform "'.concat(a,'" is redeclared in a dependency, but with a different type!'));if((i.size||1)!==(s.size||1))throw Error('Uniform "'.concat(a,'[]" is redeclared in a dependency, but with a different number of items!'))}else t[a]=s}}function it(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=t[a],s=e[a];if(i){if(i.type!==s.type)throw Error('Varying "'.concat(a,'" is redeclared in a dependency, but with a different type!'));if((i.size||1)!==(s.size||1))throw Error('Varying "'.concat(a,'[]" is redeclared in a dependency, but with a different number of items!'))}else t[a]=s}}function st(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n="".concat(t);n.length<e;)n=" ".concat(n);return n}var ot=function t(){Object(c.a)(this,t)},ct=function(t){return new ft(t)},ut=function(t){return new ht(t)},ft=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).definition=void 0,r.definition={uniforms:mt(t.uniforms),attributes:dt(t.attributes),varyings:bt(t.varyings),functions:t.functions||{},dependencies:lt(t.dependencies)},r}return Object(u.a)(n,[{key:"uniformsDefinition",get:function(){return this.definition.uniforms}},{key:"attributesDefinition",get:function(){return this.definition.attributes}},{key:"varyingsDefinition",get:function(){return this.definition.varyings}},{key:"functionsDefinition",get:function(){return this.definition.functions}},{key:"dependenciesDefinition",get:function(){return this.definition.dependencies}}]),n}(ot),ht=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).definition=void 0,r.definition={uniforms:mt(t.uniforms),attributes:{},varyings:{},functions:t.functions||{},dependencies:pt(t.dependencies)},r}return Object(u.a)(n,[{key:"uniformsDefinition",get:function(){return this.definition.uniforms}},{key:"attributesDefinition",get:function(){return this.definition.attributes}},{key:"varyingsDefinition",get:function(){return this.definition.varyings}},{key:"functionsDefinition",get:function(){return this.definition.functions}},{key:"dependenciesDefinition",get:function(){return this.definition.dependencies}}]),n}(ot);function lt(t){return Array.isArray(t)?t.map((function(t){return new ft(t)})):[]}function pt(t){return Array.isArray(t)?t.map((function(t){return new ht(t)})):[]}function mt(t){if(!t)return{};for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];e[a]=vt(t[a])}return e}function vt(t){if(!Array.isArray(t))return vt([t,1]);var e=Object(R.a)(t,2),n=e[0],r=e[1];switch(n){case"vec2":return{type:M.FLOAT_VEC2,size:r};case"vec3":return{type:M.FLOAT_VEC3,size:r};case"vec4":return{type:M.FLOAT_VEC4,size:r};case"mat2":return{type:M.FLOAT_MAT2,size:r};case"mat3":return{type:M.FLOAT_MAT3,size:r};case"mat4":return{type:M.FLOAT_MAT4,size:r};case"sampler2D":return{type:M.SAMPLER_2D,size:r};case"samplerCube":return{type:M.SAMPLER_CUBE,size:r};default:return{type:M.FLOAT,size:r}}}function dt(t){if(!t)return{};for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];e[a]=yt(t[a])}return e}function yt(t){switch(t){case"vec2":return j.FLOAT_VEC2;case"vec3":return j.FLOAT_VEC3;case"vec4":return j.FLOAT_VEC4;default:return j.FLOAT}}function bt(t){if(!t)return{};for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];e[a]=gt(t[a])}return e}function gt(t){if(!Array.isArray(t))return gt([t,1]);var e=Object(R.a)(t,2),n=e[0],r=e[1];switch(n){case"vec2":return{type:k.FLOAT_VEC2,size:r};case"vec3":return{type:k.FLOAT_VEC3,size:r};case"vec4":return{type:k.FLOAT_VEC4,size:r};case"mat2":return{type:k.FLOAT_MAT2,size:r};case"mat3":return{type:k.FLOAT_MAT3,size:r};case"mat4":return{type:k.FLOAT_MAT4,size:r};default:return{type:k.FLOAT,size:r}}}for(var Tt=function(){function t(e){Object(c.a)(this,t),this.gl=e,this.programMap=new A}return Object(u.a)(t,[{key:"createProgramAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e,n,r){var a=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.programMap.addAsync(e,Object(v.a)(m.a.mark((function t(){var e,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.gl,i=new V(e,ct(n),ut(r)),t.next=4,i.attach();case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()}]),t}(),Et=function(){function t(e){Object(c.a)(this,t),this.params=e}return Object(u.a)(t,[{key:"setData",value:function(t){var e=this.params,n=e.gl,r=e.buffer;n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}},{key:"bind",value:function(){var t=this.params,e=t.gl,n=t.buffer;e.bindBuffer(e.ARRAY_BUFFER,n)}},{key:"destroy",value:function(){var t=this.params,e=t.gl,n=t.buffer;!1!==(0,t.confirmDestroy)()&&e.deleteBuffer(n)}},{key:"buffer",get:function(){return this.params.buffer}}]),t}(),Ot=function(){function t(e){Object(c.a)(this,t),this.gl=e,this.arrayBufferMap=new A}return Object(u.a)(t,[{key:"createArrayBuffer",value:function(t,e){var n=this;return this.arrayBufferMap.add(t,(function(){var r=n.gl,a=r.createBuffer();if(!a)throw Error("Unable to create a new WebGLBuffer!");var i=new Et({gl:r,buffer:a,confirmDestroy:function(){return 0===n.arrayBufferMap.remove(t)}});return i.setData(e),i}))}}]),t}(),_t=function t(){Object(c.a)(this,t)},At=new Float32Array(4096),wt=new Float32Array(4096),xt=new Float32Array(3),jt=new Float32Array(3),Mt=new Float32Array(3),kt=new Float32Array(3),Lt=0;Lt<4096;Lt++){var Rt=Math.PI*Lt/2048;At[Lt]=Math.cos(Rt),wt[Lt]=Math.sin(Rt)}var Ft={areEqual:function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},createVec3:function(){return new Float32Array(3)},createVec4:function(){return new Float32Array(4)},add3:function(t,e,n){n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2]},substract3:function(t,e,n){n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2]},cross3:function(t,e,n){n[0]=t[1]*e[2]-t[2]*e[1],n[1]=t[2]*e[0]-t[0]*e[2],n[2]=t[0]*e[1]-t[1]*e[0]},dot3:function(t,e){var n=Object(R.a)(t,3),r=n[0],a=n[1],i=n[2],s=Object(R.a)(e,3);return r*s[0]+a*s[1]+i*s[2]},length3:function(t){return Math.sqrt(Ft.dot3(t,t))},normalize3:function(t,e){var n=Ft.length3(t),r=n>0?1/n:1;e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r},orbital3:function(t,e,n){var r=Math.sin(t),a=Math.cos(t),i=e-.5*Math.PI;n[0]=a*Math.cos(i),n[1]=a*Math.sin(i),n[2]=r},length4:function(t){var e=Object(R.a)(t,4),n=e[0],r=e[1],a=e[2],i=e[3];return Math.sqrt(n*n+r*r+a*a+i*i)},normalize4:function(t,e){var n=Ft.length4(t);e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n},transform4:function(t,e,n){n[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],n[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],n[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],n[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3]}},Ct={areEqual:Ft.areEqual,createMat3:function(){return new Float32Array(9)},createMat4:function(){return new Float32Array(16)},identity3:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},extract3From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},extractX3From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2]},extractX4From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]},extractY3From4:function(t,e){e[0]=t[4],e[1]=t[5],e[2]=t[6]},extractY4From4:function(t,e){e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7]},extractZ3From4:function(t,e){e[0]=t[8],e[1]=t[9],e[2]=t[10]},extractZ4From4:function(t,e){e[0]=t[8],e[1]=t[9],e[2]=t[10],e[3]=t[11]},lookAt4:function(t,e,n,r){r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1;var a=xt,i=jt,s=Mt,o=kt;Ft.substract3(e,t,a),Ft.normalize3(a,a),Ft.normalize3(n,o),Ft.cross3(a,o,i),Ft.cross3(i,a,s),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=0,r[4]=s[0],r[5]=s[1],r[6]=s[2],r[7]=0,r[8]=a[0],r[9]=a[1],r[10]=a[2],r[11]=0},multiply3:function(t,e,n){n[0]=t[0]*e[0]+t[3]*e[1]+t[6]*e[2],n[1]=t[1]*e[0]+t[4]*e[1]+t[7]*e[2],n[2]=t[2]*e[0]+t[5]*e[1]+t[8]*e[2],n[3]=t[0]*e[3]+t[3]*e[4]+t[6]*e[5],n[4]=t[1]*e[3]+t[4]*e[4]+t[7]*e[5],n[5]=t[2]*e[3]+t[5]*e[4]+t[8]*e[5],n[6]=t[0]*e[6]+t[3]*e[7]+t[6]*e[8],n[7]=t[1]*e[6]+t[4]*e[7]+t[7]*e[8],n[8]=t[2]*e[6]+t[5]*e[7]+t[8]*e[8]},identity4:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},multiply4:function(t,e,n){var r=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],a=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],i=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],s=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],o=t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],c=t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],u=t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],f=t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],h=t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],l=t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],p=t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],m=t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],v=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],d=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],y=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],b=t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15];n[0]=r,n[1]=a,n[2]=i,n[3]=s,n[4]=o,n[5]=c,n[6]=u,n[7]=f,n[8]=h,n[9]=l,n[10]=p,n[11]=m,n[12]=v,n[13]=d,n[14]=y,n[15]=b},invert4:function(t,e){var n=Object(R.a)(t,16),r=n[0],a=n[1],i=n[2],s=n[3],o=n[4],c=n[5],u=n[6],f=n[7],h=n[8],l=n[9],p=n[10],m=n[11],v=n[12],d=n[13],y=n[14],b=n[15],g=r*c-o*a,T=r*l-h*a,E=r*d-v*a,O=o*l-h*c,_=o*d-v*c,A=h*d-v*l,w=i*f-u*s,x=i*m-p*s,j=i*b-y*s,M=u*m-p*f,k=u*b-y*f,L=p*b-y*m,F=g*L-T*k+E*M+O*j-_*x+A*w;if(Math.abs(F)<1e-8)return!1;var C=1/F;return e[0]=(c*L-l*k+d*M)*C,e[4]=(h*k-o*L-v*M)*C,e[8]=(f*A-m*_+b*O)*C,e[12]=(p*_-u*A-y*O)*C,e[1]=(l*j-a*L-d*x)*C,e[5]=(r*L-h*j+v*x)*C,e[9]=(m*E-s*A-b*T)*C,e[13]=(i*A-p*E+y*T)*C,e[2]=(a*k-c*j+d*w)*C,e[6]=(o*j-r*k-v*w)*C,e[10]=(s*_-f*E+b*g)*C,e[14]=(u*E-i*_-y*g)*C,e[3]=(c*x-a*M-l*w)*C,e[7]=(r*M-o*x+h*w)*C,e[11]=(f*T-s*O-m*g)*C,e[15]=(i*O-u*T+p*g)*C,!0},rotation4X:function(t,e){var n=Math.cos(t),r=Math.sin(t);e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1},rotation4Y:function(t,e){var n=Math.cos(t),r=Math.sin(t);e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1},rotation4Z:function(t,e){var n=Math.cos(t),r=Math.sin(t);e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}};var Ut={deg2rad:function(t){return t*Math.PI/180},rad2deg:function(t){return 180*t/Math.PI},cos:function(t){return At[4095&(0|t)]},sin:function(t){return wt[4095&(0|t)]},clamp:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t<e?e:t>n?n:t},vector:Ft,matrix:Ct,M4_00:0,M4_10:1,M4_20:2,M4_30:3,M4_01:4,M4_11:5,M4_21:6,M4_31:7,M4_02:8,M4_12:9,M4_22:10,M4_32:11,M4_03:12,M4_13:13,M4_23:14,M4_33:15,M3_00:0,M3_10:1,M3_20:2,M3_01:3,M3_11:4,M3_21:5,M3_02:6,M3_12:7,M3_22:8},Nt=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).cameraMatrix=Ut.matrix.createMat4(),t.rotationY=Ut.matrix.createMat4(),t.rotationX=Ut.matrix.createMat4(),t}return Object(u.a)(n,[{key:"extractCameraMatrix",value:function(t){Ut.matrix.extract3From4(this.cameraMatrix,t)}},{key:"orbit",value:function(t,e,n,r,a,i){var s=this.rotationY,o=this.rotationX,c=this.cameraMatrix,u=Ut.clamp(a,-1.570796326794896,1.570796326794896),f=i;Ut.matrix.rotation4X(u,o),Ut.matrix.rotation4Y(-f,s),Ut.matrix.identity4(c),Ut.matrix.multiply4(o,s,c);var h=t,l=e,p=n+r;c[Ut.M4_03]=-h,c[Ut.M4_13]=-l,c[Ut.M4_23]=-p}}]),n}(_t),St=n(19),Dt=n.n(St),Pt=n(20),It=n.n(Pt),Bt=39.6*Math.PI/180,Vt=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n),(t=e.call(this)).perspectiveMatrix=Ut.matrix.createMat4(),t.cameraMatrix3=Ut.matrix.createMat3(),t.fieldAngle=Bt,t.near=.1,t.far=1e3;return t.orbit(0,0,0,15,0,0),t}return Object(u.a)(n,[{key:"setUniformValues",value:function(t,e,n){var r=this.near,a=this.far,i=this.fieldAngle,s=Math.tan(.5*(Math.PI-i)),o=1/(r-a),c=this.perspectiveMatrix;c[Ut.M4_00]=s*n/e,c[Ut.M4_10]=0,c[Ut.M4_20]=0,c[Ut.M4_30]=0,c[Ut.M4_01]=0,c[Ut.M4_11]=s,c[Ut.M4_21]=0,c[Ut.M4_31]=0,c[Ut.M4_02]=0,c[Ut.M4_12]=0,c[Ut.M4_22]=(r+a)*o,c[Ut.M4_32]=-1,c[Ut.M4_03]=0,c[Ut.M4_13]=0,c[Ut.M4_23]=r*a*o*2,c[Ut.M4_33]=0,Ut.matrix.extract3From4(this.cameraMatrix,this.cameraMatrix3),t.use(),t.uniforms.set("uniCameraMatrix",this.cameraMatrix),t.uniforms.set("uniCameraMatrix3",this.cameraMatrix3),t.uniforms.set("uniPerspectiveMatrix",this.perspectiveMatrix)}},{key:"id",get:function(){return"[CAMERA/PERSPECTIVE]"}},{key:"vertexShader",get:function(){return{uniforms:{uniPerspectiveMatrix:"mat4",uniCameraMatrix:"mat4",uniCameraMatrix3:"mat3"},functions:{worldPointToScreen:Dt.a,worldVectorToScreen:It.a}}}}]),n}(Nt),Xt=function(){function t(e){var n=this;Object(c.a)(this,t),this.resolution=1,this.onAnimation=void 0,this._gl=void 0,this._pointer=void 0,this._isRendering=!1,this.lastRenderingTime=0,this.textures=void 0,this.buffers=void 0,this.programs=void 0,this.camera=new Vt,this.render=function(t){if(n._isRendering){window.requestAnimationFrame(n.render);var e=n.gl,r=n.lastRenderingTime;if(n.lastRenderingTime=t,0!==r){!function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e<=0?window.devicePixelRatio:e,r=t.canvas;if(r instanceof HTMLCanvasElement){var a=Math.floor(r.clientWidth*n),i=Math.floor(r.clientHeight*n);if(r.width!==a||r.height!==i)return r.width=a,r.height=i,t.viewport(0,0,a,i),!0}}(e,n.resolution),e.clearDepth(1),e.clear(e.DEPTH_BUFFER_BIT),e.depthFunc(e.LESS),e.disable(e.DEPTH_TEST);try{var a=n.onAnimation;if("function"===typeof a)a(t,e.drawingBufferWidth,e.drawingBufferHeight),n.pointer.reset()}catch(i){n._isRendering=!1,console.error("##################################"),console.error("# Rendering   has  been  stopped #"),console.error("# because of the following error #"),console.error("##################################"),console.error(i)}}}},this._pointer=new d(e);var r=e.getContext("webgl2",{});if(r||(console.warn("WebGL2 is not available! Switching to WebGL."),r=e.getContext("webgl",{})),!r)throw new Error("Unable to create a WegGL context!");this._gl=r,this.textures=new L(r),this.buffers=new Ot(r),this.programs=new Tt(r)}return Object(u.a)(t,[{key:"refresh",value:function(){var t=this._isRendering,e=this.lastRenderingTime;this._isRendering=!0;var n=Date.now();this.lastRenderingTime=n-15,this.render(n),this._isRendering=t,this.lastRenderingTime=e}},{key:"isRendering",get:function(){return this._isRendering},set:function(t){t!==this._isRendering&&(this._isRendering=t,t&&window.requestAnimationFrame(this.render))}},{key:"gl",get:function(){return this._gl}},{key:"pointer",get:function(){return this._pointer}},{key:"width",get:function(){return this._gl.drawingBufferWidth}},{key:"height",get:function(){return this._gl.drawingBufferHeight}}]),t}(),zt=(n(66),function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).scene=void 0,t.refCanvas=i.a.createRef(),t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=Object(v.a)(m.a.mark((function t(){var e,n,r,a,i,s,o,c,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.refCanvas.current){t.next=3;break}return t.abrupt("return");case 3:return n=new Xt(e),this.scene=n,n.camera=new Vt,t.next=8,this.props.painter(n);case 8:r=t.sent,(a=n.gl).clearColor(0,0,0,0),this.props.name||a.clearColor(.3,.5,.9,1),i=this.props.dis||4,s=Ut.deg2rad(this.props.lat||15),o=this.props.x||0,c=this.props.y||0,u=this.props.z||0,n.onAnimation=function(t){a.clearDepth(1),a.depthFunc(a.LESS),a.enable(a.DEPTH_TEST),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var e=.001*t;n.camera.orbit(o,c,u,i,s,e),r.paint(t)},n.isRendering=!0,"function"===typeof this.props.onLoad&&this.props.onLoad();case 20:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var t=this.scene;t&&(t.isRendering=!1)}},{key:"render",value:function(){var t=["app-view-Preview"].concat(Object(l.a)(r.a.Converter.StringArray(this.props.className,[])));this.props.name||t.push("frame");var e=this.props,n=e.name,a=e.type;return i.a.createElement("div",{className:t.join(" ")},i.a.createElement("canvas",{ref:this.refCanvas}),n&&i.a.createElement("div",{className:"name"},n),a&&i.a.createElement("div",{className:"type"},a))}}]),n}(i.a.Component)),Gt=function t(){Object(c.a)(this,t)},Yt=function(){function t(e,n){Object(c.a)(this,t),this.def=n,this.id=void 0,this.verticesCount=void 0,this.texturesCount=void 0,this.normalsCount=void 0,this.facesCount=void 0,this.id=e,this.verticesCount=Math.floor(n.vertices.length/3),this.texturesCount=Math.floor(n.textures.length/2),this.normalsCount=Math.floor(n.normals.length/3),this.facesCount=Math.floor(n.faces.length/9)}return Object(u.a)(t,[{key:"getVertexX",value:function(t){return Ht(t,this.verticesCount),this.def.vertices[3*t+0]}},{key:"getVertexY",value:function(t){return Ht(t,this.verticesCount),this.def.vertices[3*t+1]}},{key:"getVertexZ",value:function(t){return Ht(t,this.verticesCount),this.def.vertices[3*t+2]}},{key:"getTextureU",value:function(t){return Ht(t,this.texturesCount),this.def.textures[2*t+0]}},{key:"getTextureV",value:function(t){return Ht(t,this.texturesCount),this.def.textures[2*t+1]}},{key:"getNormalX",value:function(t){return Ht(t,this.normalsCount),this.def.normals[3*t+0]}},{key:"getNormalY",value:function(t){return Ht(t,this.normalsCount),this.def.normals[3*t+1]}},{key:"getNormalZ",value:function(t){return Ht(t,this.normalsCount),this.def.normals[3*t+2]}},{key:"getFaceSmoothness",value:function(t){return Ht(t,this.facesCount),"1"===this.def.smoothness.charAt(t)}},{key:"getFaceVertex",value:function(t,e){Ht(t,this.facesCount);var n=9*t+3*e+0;return this.def.faces[n]}},{key:"getFaceTexture",value:function(t,e){Ht(t,this.facesCount);var n=9*t+3*e+1;return this.def.faces[n]}},{key:"getFaceNormal",value:function(t,e){Ht(t,this.facesCount);var n=9*t+3*e+2;return this.def.faces[n]}}]),t}();function Ht(t,e){if(t<0||t>=e)throw"Index ".concat(t," is out of range [0..").concat(e-1,"]!")}var Wt=new A,Zt={createOrGetFromCacheMeshDefinition:function(t){return qt.apply(this,arguments)}};function qt(){return(qt=Object(v.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e,t.abrupt("return",Wt.addAsync(e,Object(v.a)(m.a.mark((function t(){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.loadJson(e);case 2:return r=t.sent,t.abrupt("return",new Yt(n,r));case 4:case"end":return t.stop()}}),t)})))));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}new Float32Array([0,1,0]);var Jt=function t(e){Object(c.a)(this,t),this.location=Ut.vector.createVec3(),this.transfo=void 0,this.transfo=e},Kt=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t.transfo)).params=t,r}return Object(u.a)(n,[{key:"paint",value:function(t){var e=this.params,n=e.scene,r=e.arrayBuffer,a=e.colorTexture,i=e.program,s=e.attributesCount,o=n.gl,c=n.camera;o.enable(o.CULL_FACE),o.cullFace(o.BACK),i.use(),c.setUniformValues(i,n.width,n.height,t),a.attachToUnit(0),i.uniforms.set("uniObjectTransfo",this.transfo.value),i.uniforms.set("uniTexture",0),i.bindAttribs(r.buffer),o.drawArrays(o.TRIANGLES,0,s)}},{key:"destroy",value:function(){var t=this.params,e=t.arrayBuffer,n=t.colorTexture;e.destroy(),n.destroy()}},{key:"program",get:function(){return this.params.program}}]),n}(Jt),Qt=n(21),$t=n.n(Qt),te=n(22),ee=n.n(te),ne={createAsync:function(t,e){return re.apply(this,arguments)}};function re(){return(re=Object(v.a)(m.a.mark((function t(e,n){var r,a,i,s,o,c,u,f,h,l,p;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.scene,a=n.definitionURL,i=n.colorTextureURL,s=r.camera,o="[FRESNEL]:".concat(a),t.next=5,Zt.createOrGetFromCacheMeshDefinition(a);case 5:return c=t.sent,u=se(c),f=Math.floor(u.length/8),h=r.buffers.createArrayBuffer(o,u),t.next=11,r.textures.createImageTextureAsync({url:i,linear:!1});case 11:return l=t.sent,t.next=14,ae(r,s);case 14:return p=t.sent,t.abrupt("return",new Kt({scene:n.scene,transfo:e,arrayBuffer:h,attributesCount:f,colorTexture:l,program:p}));case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ae(t,e){return ie.apply(this,arguments)}function ie(){return(ie=Object(v.a)(m.a.mark((function t(e,n){var r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="[FRESNEL]:".concat(n.id),t.next=3,e.programs.createProgramAsync(r,{uniforms:{uniObjectTransfo:"mat4"},attributes:{attLocation:"vec3",attUV:"vec2",attNormal:"vec3"},varyings:{varNormal:"vec3",varReflexion:"vec3",varUV:"vec2"},functions:{main:$t.a},dependencies:[n.vertexShader]},{uniforms:{uniTexture:"sampler2D"},functions:{main:ee.a}});case 3:return a=t.sent,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function se(t){for(var e=[],n=0;n<t.facesCount;n++)for(var r=0;r<3;r++){var a=t.getFaceVertex(n,r);e.push(t.getVertexX(a),t.getVertexY(a),t.getVertexZ(a));var i=t.getFaceTexture(n,r);e.push(t.getTextureU(i),t.getTextureV(i));var s=t.getFaceNormal(n,r);e.push(t.getNormalX(s),t.getNormalY(s),t.getNormalZ(s))}return new Float32Array(e)}var oe=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t.transfo)).params=t,r.color=new Float32Array([0,0,0,1]),r.thickness=2,console.info("params=",t),r}return Object(u.a)(n,[{key:"setRGB",value:function(t,e,n){var r=this.color;r[0]=t,r[1]=e,r[2]=n}},{key:"setRGBA",value:function(t,e,n,r){var a=this.color;a[0]=t,a[1]=e,a[2]=n,a[3]=r}},{key:"paint",value:function(t){var e=this.params,n=e.scene,r=e.arrayBuffer,a=e.program,i=e.attributesCount,s=n.gl,o=n.camera;s.enable(s.CULL_FACE),s.cullFace(s.FRONT),a.use(),o.setUniformValues(a,n.width,n.height,t),a.uniforms.set("uniColor",this.color),a.uniforms.set("uniThickness",.001*this.thickness),a.uniforms.set("uniObjectTransfo",this.transfo.value),a.bindAttribs(r.buffer),s.drawArrays(s.TRIANGLES,0,i)}},{key:"destroy",value:function(){this.params.arrayBuffer.destroy()}},{key:"program",get:function(){return this.params.program}}]),n}(Jt),ce=n(23),ue=n.n(ce),fe=n(24),he=n.n(fe),le={createAsync:function(t){return pe.apply(this,arguments)}};function pe(){return(pe=Object(v.a)(m.a.mark((function t(e){var n,r,a,i,s,o,c,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.scene,r=e.definitionURL,a="[OUTLINE]:".concat(r),t.next=4,Zt.createOrGetFromCacheMeshDefinition(r);case 4:return i=t.sent,s=de(i),o=Math.floor(s.length/6),c=n.buffers.createArrayBuffer(a,s),t.next=10,me(n);case 10:return u=t.sent,t.abrupt("return",new oe({scene:n,transfo:e.transfo,arrayBuffer:c,attributesCount:o,program:u}));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function me(t){return ve.apply(this,arguments)}function ve(){return(ve=Object(v.a)(m.a.mark((function t(e){var n,r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.camera,r="[OUTLINE]:".concat(n.id),t.next=4,e.programs.createProgramAsync(r,{uniforms:{uniObjectTransfo:"mat4",uniThickness:"float"},attributes:{attLocation:"vec3",attNormal:"vec3"},functions:{main:ue.a},dependencies:[n.vertexShader]},{uniforms:{uniColor:"vec4"},functions:{main:he.a}});case 4:return a=t.sent,t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function de(t){for(var e=[],n=[],r=0;r<t.facesCount;r++)for(var a=0;a<3;a++){var i=t.getFaceVertex(r,a);n[i]||(n[i]=new ye(t.getVertexX(i),t.getVertexY(i),t.getVertexZ(i)));var s=n[i],o=t.getFaceNormal(r,a);s.addNormal(t.getNormalX(o),t.getNormalY(o),t.getNormalZ(o))}for(var c=0;c<t.facesCount;c++)for(var u=0;u<3;u++){var f=n[t.getFaceVertex(c,u)];e.push.apply(e,Object(l.a)(f.data))}return console.info("data=",e),new Float32Array(e)}var ye=function(){function t(e,n,r){Object(c.a)(this,t),this.x=e,this.y=n,this.z=r,this.normalX=0,this.normalY=0,this.normalZ=0,this.normalsCount=0}return Object(u.a)(t,[{key:"addNormal",value:function(t,e,n){this.normalX+=t,this.normalY+=e,this.normalZ+=n,this.normalsCount++}},{key:"data",get:function(){var t=Math.max(1,this.normalsCount),e=this.normalX/t,n=this.normalY/t,r=this.normalZ/t,a=1/Math.sqrt(e*e+n*n+r*r);return[this.x,this.y,this.z,e*a,n*a,r*a]}}]),t}(),be={Fresnel:ne,Outline:le},ge=function(){function t(){Object(c.a)(this,t),this.parent=void 0,this.transfo=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.composedTransfo=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return Object(u.a)(t,[{key:"value",get:function(){var t=this.compute(),e=this.parent;return e?(Ut.matrix.multiply4(e.transfo,t,this.composedTransfo),this.composedTransfo):t}}]),t}(),Te=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a)))._x=0,t._y=0,t._z=0,t._sx=1,t._sy=1,t._sz=1,t._lat=0,t._lng=0,t._dirty=!0,t}return Object(u.a)(n,[{key:"compute",value:function(){if(!this._dirty)return this.transfo;var t=this.x,e=this.y,n=this.z,r=this.sx,a=this.sy,i=this.sz,s=this.lat,o=this.lng,c=this.transfo,u=Ut.deg2rad(s),f=Ut.deg2rad(o),h=Math.cos(u),l=Math.sin(u),p=Math.cos(f),m=Math.sin(f);return c[Ut.M4_00]=r*p,c[Ut.M4_10]=0,c[Ut.M4_20]=-r*m,c[Ut.M4_30]=0,c[Ut.M4_01]=a*l*m,c[Ut.M4_11]=a*h,c[Ut.M4_21]=a*l*p,c[Ut.M4_31]=0,c[Ut.M4_02]=i*h*m,c[Ut.M4_12]=-i*l,c[Ut.M4_22]=i*h*p,c[Ut.M4_32]=0,c[Ut.M4_03]=t,c[Ut.M4_13]=e,c[Ut.M4_23]=n,c[Ut.M4_33]=1,this._dirty=!1,c}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._dirty=!0}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._dirty=!0}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._dirty=!0}},{key:"sx",get:function(){return this._sx},set:function(t){this._sx=t,this._dirty=!0}},{key:"sy",get:function(){return this._sy},set:function(t){this._sy=t,this._dirty=!0}},{key:"sz",get:function(){return this._sz},set:function(t){this._sz=t,this._dirty=!0}},{key:"lat",get:function(){return this._lat},set:function(t){this._lat=t,this._dirty=!0}},{key:"lng",get:function(){return this._lng},set:function(t){this._lng=t,this._dirty=!0}}]),n}(ge),Ee=function(){function t(e,n){Object(c.a)(this,t),this.body=e,this.outline=n,this.transfo=void 0;var r=this.body.transfo;if(!(r instanceof Te))throw Error("Expected a PolarLocSca transfo!");this.transfo=r}return Object(u.a)(t,[{key:"paint",value:function(t){this.outline.paint(t),this.body.paint(t)}},{key:"color",get:function(){return this.outline.color}},{key:"thickness",get:function(){return this.outline.thickness},set:function(t){this.outline.thickness=t}}]),t}(),Oe=function(t,e){return Object(v.a)(m.a.mark((function n(){var r,a,i;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new Te,n.next=3,be.Fresnel.createAsync(r,{colorTextureURL:"./assets/palette/default-64.png",definitionURL:e,scene:t});case 3:return a=n.sent,n.next=6,be.Outline.createAsync({transfo:r,definitionURL:e,scene:t});case 6:return i=n.sent,n.abrupt("return",new Ee(a,i));case 8:case"end":return n.stop()}}),n)})))()},_e=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,null,[{key:"createAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Oe(e,"./assets/mesh/Golgoth.json");case 2:return r=t.sent,t.abrupt("return",new n(r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Ae=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,null,[{key:"createAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Oe(e,"./assets/mesh/Balzac.json");case 2:return r=t.sent,t.abrupt("return",new n(r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),we=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,null,[{key:"createAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Oe(e,"./assets/mesh/Hydre.json");case 2:return r=t.sent,t.abrupt("return",new n(r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),xe=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,null,[{key:"createAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Oe(e,"./assets/mesh/Tyson.json");case 2:return r=t.sent,t.abrupt("return",new n(r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),je=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(c.a)(this,n),(t=e.call(this))._transfo=Ut.matrix.createMat4();var f=t._transfo;return f[Ut.M4_00]=s,f[Ut.M4_11]=o||s,f[Ut.M4_22]=u||s,f[Ut.M4_33]=1,f[Ut.M4_03]=r,f[Ut.M4_13]=a,f[Ut.M4_23]=i,t}return Object(u.a)(n,[{key:"compute",value:function(){return this._transfo}}]),n}(ge),Me=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t,r,a,i){var s;return Object(c.a)(this,n),(s=e.call(this)).scene=t,s.program=r,s.arrayBuffer=a,s.dropsCount=i,s._transfo=new je(0,0,0),s}return Object(u.a)(n,[{key:"paint",value:function(t){var e=this.scene,n=this.program,r=this.arrayBuffer,a=this.dropsCount,i=e.gl,s=e.camera;i.depthMask(!1),i.enable(i.BLEND),i.blendFunc(i.ONE,i.DST_ALPHA),n.use(),s.setUniformValues(n,e.width,e.height,t),n.uniforms.set("uniObjectTransfo",this.transfo.value),n.uniforms.set("uniTime",t),n.uniforms.set("uniDropSize",2*Math.min(e.width,e.height)),n.bindAttribs(r.buffer),i.drawArrays(i.POINTS,0,a),i.disable(i.BLEND),i.depthMask(!0)}},{key:"transfo",get:function(){return this._transfo}}]),n}(Gt),ke=n(25),Le=n.n(ke),Re=n(26),Fe=n.n(Re),Ce=function(t){return Object(v.a)(m.a.mark((function e(){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.buffers.createArrayBuffer("particle.smoke",Se()),e.next=3,Ue(t);case 3:return r=e.sent,e.abrupt("return",new Me(t,r,n,100));case 5:case"end":return e.stop()}}),e)})))()};function Ue(t){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(v.a)(m.a.mark((function t(e){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.camera,t.next=3,e.programs.createProgramAsync("[PARTICLE.SMOKE]:".concat(n.id),{uniforms:{uniTime:"float",uniDropSize:"float",uniObjectTransfo:"mat4"},varyings:{varTime:"float"},attributes:{attLocation:"vec3",attShift:"float",attCycle:"float",attCycleInv:"float"},functions:{main:Le.a},dependencies:[n.vertexShader]},{functions:{main:Fe.a}});case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Se(){for(var t=[],e=0;e<100;e++){var n=Math.floor(De(2e4,21e3)),r=Math.floor(De(0,2e4));t.push(De(-.5,.5),0,De(-.5,.5),r,n,1/n)}return new Float32Array(t)}function De(t,e){return t+(e-t)*Math.random()}var Pe=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t,r){var a;return Object(c.a)(this,n),(a=e.call(this)).mainObject=t,a.smoke=r,r.transfo.parent=t.transfo,a}return Object(u.a)(n,null,[{key:"createAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Oe(e,"./assets/mesh/Island-A.json");case 2:return r=t.sent,t.next=5,Ce(e);case 5:return a=t.sent,t.abrupt("return",new n(r,a));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t),this.smoke.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Ie=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t,r,a,i){var s;return Object(c.a)(this,n),(s=e.call(this)).scene=t,s.program=r,s.arrayBuffer=a,s.dropsCount=i,s._transfo=new je(0,0,0),s}return Object(u.a)(n,[{key:"paint",value:function(t){var e=this.scene,n=this.program,r=this.arrayBuffer,a=this.dropsCount,i=e.gl,s=e.camera;i.depthMask(!1),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE),n.use(),s.setUniformValues(n,e.width,e.height,t),n.uniforms.set("uniTime",t),n.uniforms.set("uniObjectTransfo",this.transfo.value),n.bindAttribs(r.buffer),i.drawArrays(i.LINES,0,a+a),i.disable(i.BLEND),i.depthMask(!0)}},{key:"transfo",get:function(){return this._transfo}}]),n}(Gt),Be=n(27),Ve=n.n(Be),Xe=n(28),ze=n.n(Xe),Ge=function(t){return Object(v.a)(m.a.mark((function e(){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.buffers.createArrayBuffer("particle.rain",We()),e.next=3,Ye(t);case 3:return r=e.sent,e.abrupt("return",new Ie(t,r,n,300));case 5:case"end":return e.stop()}}),e)})))()};function Ye(t){return He.apply(this,arguments)}function He(){return(He=Object(v.a)(m.a.mark((function t(e){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.camera,t.next=3,e.programs.createProgramAsync("[PARTICLE.RAIN]:".concat(n.id),{uniforms:{uniTime:"float",uniObjectTransfo:"mat4"},varyings:{varSegment:"float"},attributes:{attLocation:"vec3",attShift:"float",attCycle:"float",attCycleInv:"float",attSegment:"float"},functions:{main:Ve.a},dependencies:[n.vertexShader]},{functions:{main:ze.a}});case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function We(){for(var t=[],e=0;e<300;e++){var n=Math.floor(Ze(500,1e3)),r=Math.floor(Ze(0,500)),a=Ze(-1,1),i=Ze(-2,2);t.push(a,8,i,r,n,1/n,0,a,8,i,r,n,1/n,1)}return new Float32Array(t)}function Ze(t,e){return t+(e-t)*Math.random()}var qe=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t,r,a){var i;Object(c.a)(this,n),(i=e.call(this)).mainObject=t,i.helixObject=r,i.rain=a,r.transfo.parent=t.transfo,a.transfo.parent=t.transfo;return r.transfo.sx=3,r.transfo.sy=3,r.transfo.sz=3,r.transfo.y=-1,i}return Object(u.a)(n,null,[{key:"createAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var r,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Oe(e,"./assets/mesh/Stone.json");case 2:return r=t.sent,t.next=5,Oe(e,"./assets/mesh/Helix.json");case 5:return a=t.sent,t.next=8,Ge(e);case 8:return i=t.sent,t.abrupt("return",new n(r,a,i));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(u.a)(n,[{key:"paint",value:function(t){this.helixObject.transfo.lng=.2*-t,this.mainObject.paint(t),this.helixObject.paint(t),this.rain.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Je=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t,r){var a;Object(c.a)(this,n),(a=e.call(this)).mainObject=t,a.helixObject=r,r.transfo.parent=t.transfo,r.transfo.y=10;return r.transfo.sx=10,r.transfo.sy=10,r.transfo.sz=10,a}return Object(u.a)(n,null,[{key:"createAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Oe(e,"./assets/mesh/Island-B.json");case 2:return r=t.sent,t.next=5,Oe(e,"./assets/mesh/Helix.json");case 5:return a=t.sent,t.abrupt("return",new n(r,a));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(u.a)(n,[{key:"paint",value:function(t){this.helixObject.transfo.lng=.1*-t,this.mainObject.paint(t),this.helixObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Ke=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this)).mainObject=t,r}return Object(u.a)(n,null,[{key:"createAsync",value:function(){var t=Object(v.a)(m.a.mark((function t(e){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Oe(e,"./assets/mesh/Umbrella.json");case 2:return r=t.sent,t.abrupt("return",new n(r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(u.a)(n,[{key:"paint",value:function(t){this.mainObject.paint(t)}},{key:"transfo",get:function(){return this.mainObject.transfo}}]),n}(Gt),Qe=(n(67),r.a.Intl.make(n(68))),$e=r.a.View.Button,tn=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={page:0,golgoth:!1,balzac:!1,hydre:!1,tyson:!1,done:!1},t.handleLoad=function(e){switch(e){case"golgoth":t.setState({golgoth:!0},t.checkIsLoaded);break;case"balzac":t.setState({balzac:!0},t.checkIsLoaded);break;case"hydre":t.setState({hydre:!0},t.checkIsLoaded);break;case"tyson":t.setState({tyson:!0},t.checkIsLoaded);break;default:throw Error("Impossible!")}},t.checkIsLoaded=function(){t.state.golgoth&&t.state.balzac&&t.state.hydre&&t.state.tyson&&t.props.onLoad()},t.handleNextPage=function(){t.state.page>3&&(t.setState({done:!0}),window.setTimeout(t.props.onDone,500)),t.setState({page:t.state.page+1})},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=this;window.document.addEventListener("keyup",(function(e){"Escape"===e.key&&t.setState({page:666},t.handleNextPage)}))}},{key:"page",value:function(t){var e=this.state.page;return e===t?"in":e>t?"out":""}},{key:"render",value:function(){var t=this,e=["app-Intro"];return this.state.done&&e.push("hide"),i.a.createElement("div",{className:e.join(" ")},i.a.createElement(zt,{y:1,className:"golgoth",painter:_e.createAsync,name:"golgoth",type:Qe("type-golgoth"),onLoad:function(){return t.handleLoad("golgoth")}}),i.a.createElement(zt,{y:1,className:"balzac",painter:Ae.createAsync,name:"balzac",type:Qe("type-balzac"),onLoad:function(){return t.handleLoad("balzac")}}),i.a.createElement(zt,{y:0,className:"hydre",painter:we.createAsync,name:"hydre",type:Qe("type-hydre"),onLoad:function(){return t.handleLoad("hydre")}}),i.a.createElement(zt,{y:1,className:"tyson",painter:xe.createAsync,name:"tyson",type:Qe("type-tyson"),onLoad:function(){return t.handleLoad("tyson")}}),i.a.createElement("div",{className:"story"},i.a.createElement("section",{className:this.page(0)},i.a.createElement("p",null,Qe("story1")),i.a.createElement(zt,{className:"small-canvas",dis:20,lat:45,painter:Pe.createAsync}),i.a.createElement($e,{icon:"right",warning:!0,onClick:this.handleNextPage})),i.a.createElement("section",{className:this.page(1)},i.a.createElement("p",null,Qe("story2a")),i.a.createElement("div",{className:"big"},"17''"),i.a.createElement("p",null,Qe("story2b")),i.a.createElement($e,{icon:"right",warning:!0,onClick:this.handleNextPage})),i.a.createElement("section",{className:this.page(2)},i.a.createElement("p",null,Qe("story3")),i.a.createElement(zt,{className:"small-canvas",dis:38,lat:45,painter:Je.createAsync}),i.a.createElement($e,{icon:"right",warning:!0,onClick:this.handleNextPage})),i.a.createElement("section",{className:this.page(3)},i.a.createElement("p",null,Qe("story4")),i.a.createElement(zt,{className:"small-canvas",dis:15,lat:40,y:3,painter:qe.createAsync}),i.a.createElement($e,{icon:"right",warning:!0,onClick:this.handleNextPage})),i.a.createElement("section",{className:this.page(4)},i.a.createElement("p",null,Qe("story5")),i.a.createElement(zt,{className:"small-canvas",dis:7,lat:15,y:0,painter:Ke.createAsync}),i.a.createElement($e,{icon:"right",warning:!0,onClick:this.handleNextPage}))))}}]),n}(i.a.Component),en=n(16),nn=(n(69),function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).refCanvas=i.a.createRef(),t.camera=new Vt,t.scene=void 0,t.objects=void 0,t.state={loaded:!1},t.sceneRender=function(e){var n=Object(en.a)(t),r=n.scene,a=n.objects;if(r&&a){var i=r.gl;i.clearColor(.3,.5,.9,1),i.clearDepth(1),i.depthFunc(i.LESS),i.enable(i.DEPTH_TEST),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);for(var s=0,o=Object.keys(a);s<o.length;s++){a[o[s]].paint(e)}t.move(e)}},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=Object(v.a)(m.a.mark((function t(){var e,n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.refCanvas.current){t.next=3;break}return t.abrupt("return");case 3:return n=new Xt(e),this.scene=n,this.initCamera(n),t.next=8,Pe.createAsync(n);case 8:return t.t0=t.sent,t.next=11,Je.createAsync(n);case 11:return t.t1=t.sent,t.next=14,Ke.createAsync(n);case 14:return t.t2=t.sent,t.next=17,xe.createAsync(n);case 17:return t.t3=t.sent,t.next=20,we.createAsync(n);case 20:return t.t4=t.sent,t.next=23,Ae.createAsync(n);case 23:return t.t5=t.sent,t.next=26,_e.createAsync(n);case 26:return t.t6=t.sent,t.next=29,qe.createAsync(n);case 29:t.t7=t.sent,this.objects={volcano:t.t0,molino:t.t1,umbrella:t.t2,tyson:t.t3,hydre:t.t4,balzac:t.t5,golgoth:t.t6,stone:t.t7},n.onAnimation=this.sceneRender,n.isRendering=!0,this.setState({loaded:!0});case 34:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initCamera",value:function(t){var e=this.camera;t.camera=e,e.orbit(0,0,0,40,Ut.deg2rad(30),Ut.deg2rad(0))}},{key:"move",value:function(t){var e=this.objects,n=this.scene,r=this.camera;e&&n&&this.props.gameManager.play(t,e,r)}},{key:"render",value:function(){var t=["app-view-Game"].concat(Object(l.a)(r.a.Converter.StringArray(this.props.className,[])));return this.state.loaded&&t.push("show"),i.a.createElement("canvas",{ref:this.refCanvas,className:t.join(" ")})}}]),n}(i.a.Component)),rn=(n(70),r.a.View.Button),an=(r.a.Intl.make(n(71)),function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={},t}return Object(u.a)(n,[{key:"render",value:function(){var t=["app-view-Controls"].concat(Object(l.a)(r.a.Converter.StringArray(this.props.className,[])));return i.a.createElement("div",{className:t.join(" ")},i.a.createElement(rn,{icon:"right",label:"Jump"}),i.a.createElement(rn,{icon:"undo",label:"Undo"}))}}]),n}(i.a.Component)),sn=function(){function t(){Object(c.a)(this,t),this.animating=!1,this.currentTime=0,this.beginTime=0,this.endTime=0,this.jumpers=[!1,!1,!1,!1],this.steps=[],this.steps.push({sides:[-1,-1,-1,-1],timeUsed:0})}return Object(u.a)(t,[{key:"play",value:function(t,e,n){this.currentTime=t,function(t,e){e.volcano.transfo.x=-10,e.molino.transfo.x=16,e.volcano.transfo.y=Math.cos(.001878*t),e.molino.transfo.y=Math.cos(.001001*t),e.stone.transfo.y=.5*Math.sin(874e-6*t)}(t,e),function(t,e,n){var r=e.umbrella.transfo;r.y=6.5+.3*Math.cos(457e-6*t)+on(n,e),r.x=5*n,r.lng=.09*t}(t,e,this.alpha),this.locateHeroes(t,e),n.orbit(0,3,0,20,Ut.deg2rad(30),Ut.deg2rad(50*Math.cos(23e-5*t)))}},{key:"locateHeroes",value:function(t,e){this.locateTyson(t,e),this.locateHydre(t,e),this.locateBalzac(t,e),this.locateGolgoth(t,e)}},{key:"locateTyson",value:function(t,e){var n=e.tyson.transfo;n.x=5*this.alpha,n.y=on(this.alpha,e),n.z=1}},{key:"locateHydre",value:function(t,e){var n=e.hydre.transfo;n.x=7*this.alpha,n.y=on(this.alpha,e)+.9,n.z=1}},{key:"locateBalzac",value:function(t,e){var n=e.balzac.transfo;n.x=7*this.alpha,n.y=on(this.alpha,e),n.z=-1}},{key:"locateGolgoth",value:function(t,e){var n=e.golgoth.transfo;n.x=5*this.alpha,n.y=on(this.alpha,e),n.z=-1}},{key:"remainingTime",get:function(){var t,e=17,n=Object(C.a)(this.steps);try{for(n.s();!(t=n.n()).done;){e-=t.value.timeUsed}}catch(r){n.e(r)}finally{n.f()}return this.animating&&(e-=.001*(this.currentTime-this.beginTime)),e}},{key:"alpha",get:function(){var t=this.currentTime,e=this.beginTime,n=this.endTime,r=Ut.clamp((t-e)/(n-e),0,1);return 1===(1&this.steps.length)?this.animating?2*r-1:-1:this.animating?1-2*r:1}}]),t}();function on(t,e){if(t<0){var n=-t,r=1-n;return e.volcano.transfo.y*n+e.stone.transfo.y*r}var a=t,i=1-a;return e.molino.transfo.y*a+e.stone.transfo.y*i}n(72);r.a.Font.loadJosefin(),r.a.Font.loadMysteryQuest();var cn=function(t){Object(f.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).gameManager=new sn,t.state={intro:!0},t.handleStart=function(){t.setState({intro:!1})},t}return Object(u.a)(n,[{key:"render",value:function(){var t=this.state.intro,e=["App","thm-bg0"];return this.props.className&&e.push(this.props.className),i.a.createElement("div",{className:e.join(" ")},t&&i.a.createElement(tn,{onLoad:un,onDone:this.handleStart}),!t&&i.a.createElement(nn,{gameManager:this.gameManager}),!t&&i.a.createElement(an,{gameManager:this.gameManager}))}}]),n}(i.a.Component);function un(){var t=document.getElementById("splash");t&&(t.classList.add("hide"),window.setTimeout((function(){var e=t.parentNode;e&&e.removeChild(t)}),1e3))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.Theme.register("default",{bg0:"#222",bg3:"#555"}),r.a.Theme.apply("default"),r.a.Font.loadJosefin(),o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(cn,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.f9fc1950.chunk.js.map