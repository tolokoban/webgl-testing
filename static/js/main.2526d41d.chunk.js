(this["webpackJsonpwebgl-testing"]=this["webpackJsonpwebgl-testing"]||[]).push([[0],{18:function(t,e,r){t.exports=r.p+"static/media/perspective.world-point-to-screen.34658b6e.vert"},19:function(t,e,r){t.exports=r.p+"static/media/perspective.world-vector-to-screen.79a1763d.vert"},20:function(t,e,r){t.exports=r.p+"static/media/main.a91ec25c.vert"},21:function(t,e,r){t.exports=r.p+"static/media/main.a27a283f.frag"},22:function(t,e,r){t.exports=r.p+"static/media/main.d0ebbab8.vert"},23:function(t,e,r){t.exports=r.p+"static/media/main.cb7cba22.frag"},24:function(t,e,r){t.exports=r(62)},59:function(t,e,r){},61:function(t,e,r){},62:function(t,e,r){"use strict";r.r(e);var n=r(10),a=r(0),i=r.n(a),o=r(13),s=r.n(o),c=(r(59),r(3)),u=r.n(c),f=r(4),h=r(1),l=r(2),m=r(6),v=r(5),d=function(){function t(e){var r=this;Object(h.a)(this,t),this._x=0,this._y=0,this._down=!1,this._downTime=0,this._eventDown=!1,this._eventUp=!1,this.canvas=void 0,this.onMouseMove=function(t){r.computeCoords(t.clientX,t.clientY)},this.onTouchMove=function(t){var e=t.touches[0];r.computeCoords(e.clientX,e.clientY)},this.onMouseDown=function(t){r.onDown(t.clientX,t.clientY)},this.onTouchStart=function(t){var e=t.touches[0];r.onDown(e.clientX,e.clientY)},this.onMouseUp=function(t){r.onUp(t.clientX,t.clientY)},this.onTouchEnd=function(t){var e=t.touches[0];r.onUp(e.clientX,e.clientY)},this.canvas=e,window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mousedown",this.onMouseDown,!0),window.addEventListener("touchstart",this.onTouchStart,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("touchend",this.onTouchEnd,!0)}return Object(l.a)(t,[{key:"reset",value:function(){this._eventDown=!1,this._eventUp=!1}},{key:"onDown",value:function(t,e){0===this._downTime&&(this.computeCoords(t,e),this._down=!0,this._eventDown=!0,this._downTime=Date.now())}},{key:"onUp",value:function(t,e){0!==this._downTime&&(this.computeCoords(t,e),this._down=!1,this._eventUp=!0,this._downTime=0)}},{key:"computeCoords",value:function(t,e){var r=this.canvas.getBoundingClientRect(),n=t-r.left,a=e-r.top,i=r.width,o=r.height;this._x=2*(n/i-.5),this._y=2*(a/o-.5)}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"down",get:function(){return this._down}},{key:"eventUp",get:function(){return this._eventUp}},{key:"eventDown",get:function(){return this._eventDown}}]),t}(),p={loadImage:function(t){return new Promise((function(e,r){var n=new Image;n.onload=function(){return e(n)},n.onerror=function(){console.error("Unable to load image from URL:",t),r(t)},n.src=t}))},loadJson:function(t){return E.apply(this,arguments)},loadText:T};function T(t){return g.apply(this,arguments)}function g(){return(g=Object(f.a)(u.a.mark((function t(e){var r,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:return r=t.sent,t.next=6,r.text();case 6:return n=t.sent,t.abrupt("return",n);case 10:throw t.prev=10,t.t0=t.catch(0),console.error("Unable to load text from URL:",e),console.error(t.t0),t.t0;case 15:case"end":return t.stop()}}),t,null,[[0,10]])})))).apply(this,arguments)}function E(){return(E=Object(f.a)(u.a.mark((function t(e){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T(e);case 2:return r=t.sent,t.prev=3,t.abrupt("return",JSON.parse(r));case 7:throw t.prev=7,t.t0=t.catch(3),console.error("Unable to parse JSON:",e),console.error(t.t0),t.t0;case 12:case"end":return t.stop()}}),t,null,[[3,7]])})))).apply(this,arguments)}var y,b,_,A=function(){function t(e,r,n){Object(h.a)(this,t),this.gl=e,this.id=r,this.texture=void 0,this.target=void 0,this.units=void 0;var a=e.createTexture();if(!a)throw Error('[FlatLand] Unable to create texture "'.concat(r,'"!'));switch(this.texture=a,n){case"2d":this.target=e.TEXTURE_2D;break;case"cubeMap":this.target=e.TEXTURE_CUBE_MAP;break;default:throw Error('[FlatLand.Texture] Unknow target "'.concat(n,'"! Available targets are "2d", "cubeMap", "3d" and "2dArray".'))}this.units=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7,e.TEXTURE8,e.TEXTURE9,e.TEXTURE10,e.TEXTURE11,e.TEXTURE12,e.TEXTURE13,e.TEXTURE14,e.TEXTURE15]}return Object(l.a)(t,[{key:"attachToUnit",value:function(t){var e=this.gl,r=this.texture,n=this.target,a=this.units;if(t<0)throw Error("[FlatLand.Texture.attachToUnit] unitIndex must be positive!");if(t>a.length-1)throw Error("[FlatLand.Texture.attachToUnit] unitIndex must be lower than ".concat(a.length,"!"));e.activeTexture(a[t]),e.bindTexture(n,r)}}]),t}(),O=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(t){var n;Object(h.a)(this,r),(n=e.call(this,t.gl,t.id,"2d")).params=t;var a=t.gl,i=t.linear?a.LINEAR:a.NEAREST;return a.bindTexture(a.TEXTURE_2D,n.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.source),n}return Object(l.a)(r,[{key:"update",value:function(t){var e=this.params.gl;e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}},{key:"destroy",value:function(){return!!this.params.confirmDestroy()&&(this.params.gl.deleteTexture(this.texture),!0)}},{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}}]),r}(A),x=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(t){var n;Object(h.a)(this,r),(n=e.call(this,t.gl,t.id,"cubeMap")).params=t;var a=t.gl;return a.bindTexture(a.TEXTURE_CUBE_MAP,n.texture),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosX),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegX),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosY),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegY),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourcePosZ),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t.sourceNegZ),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a instanceof WebGL2RenderingContext&&a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_R,a.CLAMP_TO_EDGE),a.generateMipmap(a.TEXTURE_CUBE_MAP),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),n}return Object(l.a)(r,[{key:"destroy",value:function(){return!!this.params.confirmDestroy()&&(this.params.gl.deleteTexture(this.texture),!0)}}]),r}(A),M=function(){function t(){Object(h.a)(this,t),this.map=new Map}return Object(l.a)(t,[{key:"exists",value:function(t){var e=this.map;if(e.has(t)){var r=e.get(t);return r&&r.count++,!0}return!1}},{key:"get",value:function(t){var e=this.map.get(t);if(e)return e.value}},{key:"add",value:function(t,e){if(this.map.get(t))throw Error('An item with id "'.concat(t,'" already exists!'));this.map.set(t,{count:1,value:e})}},{key:"remove",value:function(t){var e=this.map.get(t);return e?(e.count--,e.count<=0&&this.map.delete(t),e.count):-1}}]),t}(),w=function(){function t(e){Object(h.a)(this,t),this.gl=e,this.imageTexturesMap=new M,this.cubeMapTexturesMap=new M}return Object(l.a)(t,[{key:"createImageTextureAsync",value:function(){var t=Object(f.a)(u.a.mark((function t(e){var r,n,a,i,o,s,c=this;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.gl,n=this.imageTexturesMap,a=e.url,i=e.linear,n.exists(a)){t.next=8;break}return t.next=5,p.loadImage(a);case 5:o=t.sent,s=new O({id:a,gl:r,source:o,width:o.width,height:o.height,linear:i,confirmDestroy:function(){return 0===c.imageTexturesMap.remove(a)}}),n.add(a,s);case 8:return t.abrupt("return",n.get(a));case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createCubeMapTextureAsync",value:function(){var t=Object(f.a)(u.a.mark((function t(e){var r,n,a,i,o,s,c,f,h,l,m=this;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.gl,(n=this.cubeMapTexturesMap).exists(e)){t.next=23;break}return a=e.split("?"),t.next=5,p.loadImage(a.join("1"));case 5:return i=t.sent,t.next=8,p.loadImage(a.join("2"));case 8:return o=t.sent,t.next=11,p.loadImage(a.join("3"));case 11:return s=t.sent,t.next=14,p.loadImage(a.join("4"));case 14:return c=t.sent,t.next=17,p.loadImage(a.join("5"));case 17:return f=t.sent,t.next=20,p.loadImage(a.join("6"));case 20:h=t.sent,l=new x({gl:r,id:e,sourcePosX:i,sourceNegX:o,sourcePosY:s,sourceNegY:c,sourcePosZ:f,sourceNegZ:h,confirmDestroy:function(){return 0===m.cubeMapTexturesMap.remove(e)}}),n.add(e,l);case 23:return t.abrupt("return",n.get(e));case 24:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),k=r(14),R=r(8),F=r(7),L=r(15);!function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4"}(y||(y={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4",t[t.FLOAT_MAT2=4]="FLOAT_MAT2",t[t.FLOAT_MAT3=5]="FLOAT_MAT3",t[t.FLOAT_MAT4=6]="FLOAT_MAT4",t[t.BYTE=7]="BYTE",t[t.UNSIGNED_BYTE=8]="UNSIGNED_BYTE",t[t.SHORT=9]="SHORT",t[t.UNSIGNED_SHORT=10]="UNSIGNED_SHORT",t[t.INT=11]="INT",t[t.UNSIGNED_INT=12]="UNSIGNED_INT",t[t.BOOL=13]="BOOL",t[t.SAMPLER_2D=14]="SAMPLER_2D",t[t.SAMPLER_CUBE=15]="SAMPLER_CUBE"}(b||(b={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.FLOAT_VEC2=1]="FLOAT_VEC2",t[t.FLOAT_VEC3=2]="FLOAT_VEC3",t[t.FLOAT_VEC4=3]="FLOAT_VEC4",t[t.FLOAT_MAT2=4]="FLOAT_MAT2",t[t.FLOAT_MAT3=5]="FLOAT_MAT3",t[t.FLOAT_MAT4=6]="FLOAT_MAT4"}(_||(_={}));var U={getAttributeSize:function(t){switch(t){case y.FLOAT_VEC2:return 2;case y.FLOAT_VEC3:return 3;case y.FLOAT_VEC4:return 4;default:return 1}},getAttributeTypeCodeName:function(t){return C.get(t)},getUniformTypeCodeName:function(t){return S.get(t)},getVaryingTypeCodeName:function(t){return j.get(t)},getWebGLTypeFromAttributeType:function(t,e){switch(e){case y.FLOAT_VEC2:return t.FLOAT_VEC2;case y.FLOAT_VEC3:return t.FLOAT_VEC3;case y.FLOAT_VEC4:return t.FLOAT_VEC4;default:return t.FLOAT}}};var C=new Map;C.set(y.FLOAT,"float"),C.set(y.FLOAT_VEC2,"vec2"),C.set(y.FLOAT_VEC3,"vec3"),C.set(y.FLOAT_VEC4,"vec4");var j=new Map;j.set(_.FLOAT,"float"),j.set(_.FLOAT_VEC2,"vec2"),j.set(_.FLOAT_VEC3,"vec3"),j.set(_.FLOAT_VEC4,"vec4"),j.set(_.FLOAT_MAT2,"mat2"),j.set(_.FLOAT_MAT3,"mat3"),j.set(_.FLOAT_MAT4,"mat4");var S=new Map;S.set(b.BOOL,"bool"),S.set(b.BYTE,"int"),S.set(b.SHORT,"int"),S.set(b.INT,"int"),S.set(b.UNSIGNED_BYTE,"uint"),S.set(b.UNSIGNED_SHORT,"uint"),S.set(b.UNSIGNED_INT,"uint"),S.set(b.SAMPLER_2D,"sampler2D"),S.set(b.SAMPLER_CUBE,"samplerCube"),S.set(b.FLOAT,"float"),S.set(b.FLOAT_VEC2,"vec2"),S.set(b.FLOAT_VEC3,"vec3"),S.set(b.FLOAT_VEC4,"vec4"),S.set(b.FLOAT_MAT2,"mat2"),S.set(b.FLOAT_MAT3,"mat3"),S.set(b.FLOAT_MAT4,"mat4");var D=function(){function t(e,r,n){Object(h.a)(this,t),this.uniformsDefinition=n,this.uniformSetters=new Map,this.attachProgram(e,r)}return Object(l.a)(t,[{key:"set",value:function(t,e){var r=this.uniformSetters.get(t);r&&r(e)}},{key:"exists",value:function(t){return this.uniformSetters.has(t)}},{key:"attachProgram",value:function(t,e){for(var r=0,n=Object.keys(this.uniformsDefinition);r<n.length;r++){var a=n[r];if(t.getUniformLocation(e,a)){var i=this.uniformsDefinition[a],o=!!(i.size&&i.size>1);switch(i.type){case b.BYTE:case b.UNSIGNED_BYTE:case b.SHORT:case b.UNSIGNED_SHORT:case b.INT:case b.UNSIGNED_INT:case b.SAMPLER_2D:case b.SAMPLER_CUBE:this.attachProgramInt(t,e,a,o);break;case b.FLOAT:this.attachProgramFloat(t,e,a,o);break;case b.FLOAT_VEC2:this.attachProgramVec2(t,e,a,o);break;case b.FLOAT_VEC3:this.attachProgramVec3(t,e,a,o);break;case b.FLOAT_VEC4:this.attachProgramVec4(t,e,a,o);break;case b.FLOAT_MAT2:this.attachProgramMat2(t,e,a,o);break;case b.FLOAT_MAT3:this.attachProgramMat3(t,e,a,o);break;case b.FLOAT_MAT4:this.attachProgramMat4(t,e,a,o);break;default:throw Error('[AbstractShader.attachProgram] Unknown type for uniform "'.concat(a,'": ').concat(i.type,"[").concat(i.size||1,"]!"))}}else N(a)}}},{key:"attachProgramInt",value:function(t,e,r,n){var a=t.getUniformLocation(e,r);this.uniformSetters.set(r,n?function(e){return t.uniform1iv(a,e)}:function(e){return t.uniform1i(a,e)})}},{key:"attachProgramFloat",value:function(t,e,r,n){var a=t.getUniformLocation(e,r);this.uniformSetters.set(r,n?function(e){return t.uniform1fv(a,e)}:function(e){return t.uniform1f(a,e)})}},{key:"attachProgramVec2",value:function(t,e,r,n){if(n)throw Error("You cannot use array of vec2!");var a=t.getUniformLocation(e,r);this.uniformSetters.set(r,(function(e){return t.uniform2fv(a,e)}))}},{key:"attachProgramVec3",value:function(t,e,r,n){if(n)throw Error("You cannot use array of vec3!");var a=t.getUniformLocation(e,r);this.uniformSetters.set(r,(function(e){return t.uniform3fv(a,e)}))}},{key:"attachProgramVec4",value:function(t,e,r,n){if(n)throw Error("You cannot use array of vec4!");var a=t.getUniformLocation(e,r);this.uniformSetters.set(r,(function(e){return t.uniform4fv(a,e)}))}},{key:"attachProgramMat2",value:function(t,e,r,n){if(n)throw Error("You cannot use array of mat2!");var a=t.getUniformLocation(e,r);this.uniformSetters.set(r,(function(e){return t.uniformMatrix2fv(a,!1,e)}))}},{key:"attachProgramMat3",value:function(t,e,r,n){if(n)throw Error("You cannot use array of mat3!");var a=t.getUniformLocation(e,r);this.uniformSetters.set(r,(function(e){return t.uniformMatrix3fv(a,!1,e)}))}},{key:"attachProgramMat4",value:function(t,e,r,n){if(n)throw Error("You cannot use array of mat4!");var a=t.getUniformLocation(e,r);this.uniformSetters.set(r,(function(e){return t.uniformMatrix4fv(a,!1,e)}))}}]),t}();function N(t){console.warn('Uniform "'.concat(t,'" has not been compiled in this program!')),console.warn("Shader compilation removes everything that is not used by the code.")}var P=Float32Array.BYTES_PER_ELEMENT,B=function(){function t(e,r,n){Object(h.a)(this,t),this.gl=e,this.prg=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=[],this.uniformSetters=void 0,this.vertexShader=r,this.fragmentShader=n}return Object(l.a)(t,[{key:"bindAttribs",value:function(t){var e=this.gl,r=this.prg,n=this.attributes;if(!r)throw Error("This program has not been attached yet!");e.bindBuffer(e.ARRAY_BUFFER,t);var a,i=Object(L.a)(n);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.enableVertexAttribArray(o.location),e.vertexAttribPointer(o.location,o.size,e.FLOAT,o.normalization,o.totalSize,o.offset)}}catch(s){i.e(s)}finally{i.f()}}},{key:"attach",value:function(){var t=Object(f.a)(u.a.mark((function t(){var e,r,n,a,i,o,s,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.prg&&this.detach(),e=Q(this.vertexShader),(r=Q(this.fragmentShader)).attributes={},r.varyings=Object(F.a)(Object(F.a)({},e.varyings),r.varyings),t.next=7,G(e);case 7:return n=t.sent,t.next=10,z(r);case 10:if(a=t.sent,i=this.gl,o=V(i,n),s=I(i,a),c=i.createProgram()){t.next=17;break}throw Error("Unable to create a new WebGLProgram!");case 17:this.prg=c,i.attachShader(c,o),i.attachShader(c,s),i.linkProgram(c),this.prepareUniformsForFastBinding(e.attributes),this.uniformSetters=new D(this.gl,this.prg,Object(F.a)(Object(F.a)({},e.uniforms),r.uniforms));case 23:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"detach",value:function(){var t=this.prg,e=this.gl;t&&(e.deleteProgram(t),delete this.prg)}},{key:"prepareUniformsForFastBinding",value:function(t){var e=this.gl,r=this.prg;if(!r)throw Error("This program has not been attached yet!");for(var n=[],a=0,i=0,o=Object.keys(t);i<o.length;i++){var s=o[i],c=t[s],u={location:e.getAttribLocation(r,s),offset:a,normalization:!1,size:U.getAttributeSize(c),totalSize:0,type:U.getWebGLTypeFromAttributeType(e,c)};n.push(u),a+=u.size*P}for(var f=a,h=0,l=n;h<l.length;h++){l[h].totalSize=f}this.attributes=n}},{key:"use",value:function(){var t=this.prg,e=this.gl;if(!t)throw Error("This program has not been attached yet!");e.useProgram(t)}},{key:"uniforms",get:function(){var t=this.uniformSetters;if(!t)throw Error("Can't get uniforms because the program has not been attached yet!\nprg.attach()");return t}}]),t}();function V(t,e){return X(t.VERTEX_SHADER,t,e)}function I(t,e){return X(t.FRAGMENT_SHADER,t,e)}function X(t,e,r){if(t!==e.VERTEX_SHADER&&t!==e.FRAGMENT_SHADER)throw Error("Type must be VERTEX_SHADER or FRAGMENT_SHADER!");var n=e.createShader(t);if(!n)throw Error("Unable to create a ".concat(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT"," shader!"));if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(n)||"NULL";throw console.error("An error occurred compiling the shader with the following code:"),console.info(function(t){var e,r=[],n=t.split("\n"),a=0,i=Object(L.a)(n);try{for(i.s();!(e=i.n()).done;){var o=e.value;a++,r.push("".concat(at(a)," | ").concat(o))}}catch(s){i.e(s)}finally{i.f()}return r.join("\n")}(r)),console.error("Here is the error: ".concat(a)),console.info(function(t,e){var r=t.split(/\n\r?/);r.unshift(""),$.lastIndex=-1;var n=$.exec(e);if(!n)return t;for(var a=Object(R.a)(n,3)[2],i=Number(a),o=Math.max(1,i-2),s=Math.min(r.length-1,i+2),c=["Here is an extract of the shader code:"],u=o;u<=s;u++)c.push("| ".concat(u,":    ").concat(r[u]));return c.join("\n")}(r,a)),Error("Unable to create a ".concat(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT"," shader!"))}return n}function G(t){return Y.apply(this,arguments)}function Y(){return(Y=Object(f.a)(u.a.mark((function t(e){var r,n,a,i,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],(n=W(e.uniforms))&&r.push(n),(a=q(e.attributes))&&r.push(a),(i=Z(e.varyings))&&r.push(i),t.next=9,J(e.functions);case 9:return o=t.sent,r.push(o),t.abrupt("return",r.join("\n"));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function z(t){return H.apply(this,arguments)}function H(){return(H=Object(f.a)(u.a.mark((function t(e){var r,n,a,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=["precision mediump float;"],(n=W(e.uniforms))&&r.push(n),(a=Z(e.varyings))&&r.push(a),t.next=7,J(e.functions);case 7:return i=t.sent,r.push(i),t.abrupt("return",r.join("\n"));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function W(t){return Object.keys(t).map((function(e){var r=t[e],n=U.getUniformTypeCodeName(r.type);if(!n)throw Error('Unknown type for uniform "'.concat(e,'": ').concat(r,"!"));var a=(r.size||0)>1?"[".concat(r.size,"]"):"";return"uniform ".concat(n," ").concat(e).concat(a,";")})).join("\n")}function Z(t){return Object.keys(t).map((function(e){var r=t[e],n=U.getVaryingTypeCodeName(r.type);if(!n)throw Error('Unknown type for varying "'.concat(e,'": ').concat(r,"!"));var a=(r.size||0)>1?"[".concat(r.size,"]"):"";return"varying ".concat(n," ").concat(e).concat(a,";")})).join("\n")}function q(t){return Object.keys(t).map((function(e){var r=t[e],n=U.getAttributeTypeCodeName(r);if(!n)throw Error('Unknown type for attribute "'.concat(e,'": ').concat(r,"!"));return"attribute ".concat(n," ").concat(e,";")})).join("\n")}function J(t){return K.apply(this,arguments)}function K(){return(K=Object(f.a)(u.a.mark((function t(e){var r,n,a,i,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],n=Object.keys(e);case 2:if(!(n.length>0)){t.next=17;break}if(a=n.pop()){t.next=6;break}return t.abrupt("break",17);case 6:if(i=e[a],!Array.isArray(i)){t.next=11;break}r.push.apply(r,Object(k.a)(i)),t.next=15;break;case 11:return t.next=13,p.loadText(i);case 13:o=t.sent,r.push(o);case 15:t.next=2;break;case 17:return t.abrupt("return",r.join("\n"));case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var $=/ERROR: ([0-9]+):([0-9]+):/g;function Q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{var r={attributes:Object(F.a)({},t.attributesDefinition),functions:Object(F.a)({},t.functionsDefinition),uniforms:Object(F.a)({},t.uniformsDefinition),varyings:Object(F.a)({},t.varyingsDefinition)};if(0===e.length&&"undefined"===typeof r.functions.main)throw Error("A shader must have a 'void main()' function!");e.push(t);var n,a=Object(L.a)(t.dependenciesDefinition);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(-1===e.indexOf(i)){var o={attributes:Object(F.a)({},i.attributesDefinition),functions:Object(F.a)({},i.functionsDefinition),uniforms:Object(F.a)({},i.uniformsDefinition),varyings:Object(F.a)({},i.varyingsDefinition)};delete o.functions.main,et(r.attributes,o.attributes),rt(r.uniforms,o.uniforms),nt(r.varyings,o.varyings),tt(r.functions,o.functions)}}}catch(s){a.e(s)}finally{a.f()}return r}catch(c){throw Error("Error in ".concat(t.constructor.name,":\n").concat(c))}}function tt(t,e){for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=t[a],o=e[a];i||(t[a]=o)}}function et(t,e){for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=t[a],o=e[a];if(i){if(i!==o)throw Error('Attribute "'.concat(a,'" is redeclared in a dependency, but with a different type!'))}else t[a]=o}}function rt(t,e){for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=t[a],o=e[a];if(i){if(i.type!==o.type)throw Error('Uniform "'.concat(a,'" is redeclared in a dependency, but with a different type!'));if((i.size||1)!==(o.size||1))throw Error('Uniform "'.concat(a,'[]" is redeclared in a dependency, but with a different number of items!'))}else t[a]=o}}function nt(t,e){for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=t[a],o=e[a];if(i){if(i.type!==o.type)throw Error('Varying "'.concat(a,'" is redeclared in a dependency, but with a different type!'));if((i.size||1)!==(o.size||1))throw Error('Varying "'.concat(a,'[]" is redeclared in a dependency, but with a different number of items!'))}else t[a]=o}}function at(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r="".concat(t);r.length<e;)r=" ".concat(r);return r}var it=function t(){Object(h.a)(this,t)},ot=function(t){return new ct(t)},st=function(t){return new ut(t)},ct=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(t){var n;return Object(h.a)(this,r),(n=e.call(this)).definition=void 0,n.definition={uniforms:lt(t.uniforms),attributes:vt(t.attributes),varyings:pt(t.varyings),functions:t.functions||{},dependencies:ft(t.dependencies)},n}return Object(l.a)(r,[{key:"uniformsDefinition",get:function(){return this.definition.uniforms}},{key:"attributesDefinition",get:function(){return this.definition.attributes}},{key:"varyingsDefinition",get:function(){return this.definition.varyings}},{key:"functionsDefinition",get:function(){return this.definition.functions}},{key:"dependenciesDefinition",get:function(){return this.definition.dependencies}}]),r}(it),ut=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(t){var n;return Object(h.a)(this,r),(n=e.call(this)).definition=void 0,n.definition={uniforms:lt(t.uniforms),attributes:{},varyings:{},functions:t.functions||{},dependencies:ht(t.dependencies)},n}return Object(l.a)(r,[{key:"uniformsDefinition",get:function(){return this.definition.uniforms}},{key:"attributesDefinition",get:function(){return this.definition.attributes}},{key:"varyingsDefinition",get:function(){return this.definition.varyings}},{key:"functionsDefinition",get:function(){return this.definition.functions}},{key:"dependenciesDefinition",get:function(){return this.definition.dependencies}}]),r}(it);function ft(t){return Array.isArray(t)?t.map((function(t){return new ct(t)})):[]}function ht(t){return Array.isArray(t)?t.map((function(t){return new ut(t)})):[]}function lt(t){if(!t)return{};for(var e={},r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];e[a]=mt(t[a])}return e}function mt(t){if(!Array.isArray(t))return mt([t,1]);var e=Object(R.a)(t,2),r=e[0],n=e[1];switch(r){case"vec2":return{type:b.FLOAT_VEC2,size:n};case"vec3":return{type:b.FLOAT_VEC3,size:n};case"vec4":return{type:b.FLOAT_VEC4,size:n};case"mat2":return{type:b.FLOAT_MAT2,size:n};case"mat3":return{type:b.FLOAT_MAT3,size:n};case"mat4":return{type:b.FLOAT_MAT4,size:n};case"sampler2D":return{type:b.SAMPLER_2D,size:n};case"samplerCube":return{type:b.SAMPLER_CUBE,size:n};default:return{type:b.FLOAT,size:n}}}function vt(t){if(!t)return{};for(var e={},r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];e[a]=dt(t[a])}return e}function dt(t){switch(t){case"vec2":return y.FLOAT_VEC2;case"vec3":return y.FLOAT_VEC3;case"vec4":return y.FLOAT_VEC4;default:return y.FLOAT}}function pt(t){if(!t)return{};for(var e={},r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];e[a]=Tt(t[a])}return e}function Tt(t){if(!Array.isArray(t))return Tt([t,1]);var e=Object(R.a)(t,2),r=e[0],n=e[1];switch(r){case"vec2":return{type:_.FLOAT_VEC2,size:n};case"vec3":return{type:_.FLOAT_VEC3,size:n};case"vec4":return{type:_.FLOAT_VEC4,size:n};case"mat2":return{type:_.FLOAT_MAT2,size:n};case"mat3":return{type:_.FLOAT_MAT3,size:n};case"mat4":return{type:_.FLOAT_MAT4,size:n};default:return{type:_.FLOAT,size:n}}}for(var gt=function(){function t(e){Object(h.a)(this,t),this.gl=e,this.programMap=new M}return Object(l.a)(t,[{key:"createProgramAsync",value:function(){var t=Object(f.a)(u.a.mark((function t(e,r,n){var a,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.programMap.exists(e)){t.next=2;break}return t.abrupt("return",this.programMap.get(e));case 2:return a=this.gl,i=new B(a,ot(r),st(n)),t.next=6,i.attach();case 6:return this.programMap.add(e,i),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})));return function(e,r,n){return t.apply(this,arguments)}}()}]),t}(),Et=function(){function t(e){Object(h.a)(this,t),this.params=e}return Object(l.a)(t,[{key:"setData",value:function(t){var e=this.params,r=e.gl,n=e.buffer;r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)}},{key:"bind",value:function(){var t=this.params,e=t.gl,r=t.buffer;e.bindBuffer(e.ARRAY_BUFFER,r)}},{key:"destroy",value:function(){var t=this.params,e=t.gl,r=t.buffer;!1!==(0,t.confirmDestroy)()&&e.deleteBuffer(r)}},{key:"buffer",get:function(){return this.params.buffer}}]),t}(),yt=function(){function t(e){Object(h.a)(this,t),this.gl=e,this.arrayBufferMap=new M}return Object(l.a)(t,[{key:"createArrayBuffer",value:function(t,e){var r=this;if(this.arrayBufferMap.exists(t))return this.arrayBufferMap.get(t);var n=this.gl,a=n.createBuffer();if(!a)throw Error("Unable to create a new WebGLBuffer!");var i=new Et({gl:n,buffer:a,confirmDestroy:function(){return 0===r.arrayBufferMap.remove(t)}});return i.setData(e),this.arrayBufferMap.add(t,i),i}}]),t}(),bt=function t(){Object(h.a)(this,t)},_t=new Float32Array(4096),At=new Float32Array(4096),Ot=new Float32Array(3),xt=new Float32Array(3),Mt=new Float32Array(3),wt=new Float32Array(3),kt=0;kt<4096;kt++){var Rt=Math.PI*kt/2048;_t[kt]=Math.cos(Rt),At[kt]=Math.sin(Rt)}var Ft={areEqual:function(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0},createVec3:function(){return new Float32Array(3)},createVec4:function(){return new Float32Array(4)},add3:function(t,e,r){r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2]},substract3:function(t,e,r){r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2]},cross3:function(t,e,r){r[0]=t[1]*e[2]-t[2]*e[1],r[1]=t[2]*e[0]-t[0]*e[2],r[2]=t[0]*e[1]-t[1]*e[0]},dot3:function(t,e){var r=Object(R.a)(t,3),n=r[0],a=r[1],i=r[2],o=Object(R.a)(e,3);return n*o[0]+a*o[1]+i*o[2]},length3:function(t){return Math.sqrt(Ft.dot3(t,t))},normalize3:function(t,e){var r=Ft.length3(t),n=r>0?1/r:1;e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n},orbital3:function(t,e,r){var n=Math.sin(t),a=Math.cos(t),i=e-.5*Math.PI;r[0]=a*Math.cos(i),r[1]=a*Math.sin(i),r[2]=n},length4:function(t){var e=Object(R.a)(t,4),r=e[0],n=e[1],a=e[2],i=e[3];return Math.sqrt(r*r+n*n+a*a+i*i)},normalize4:function(t,e){var r=Ft.length4(t);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r},transform4:function(t,e,r){r[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],r[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],r[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],r[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3]}},Lt={areEqual:Ft.areEqual,createMat3:function(){return new Float32Array(9)},createMat4:function(){return new Float32Array(16)},identity3:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},extract3From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},extractX3From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2]},extractX4From4:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]},extractY3From4:function(t,e){e[0]=t[4],e[1]=t[5],e[2]=t[6]},extractY4From4:function(t,e){e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7]},extractZ3From4:function(t,e){e[0]=t[8],e[1]=t[9],e[2]=t[10]},extractZ4From4:function(t,e){e[0]=t[8],e[1]=t[9],e[2]=t[10],e[3]=t[11]},lookAt4:function(t,e,r,n){n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1;var a=Ot,i=xt,o=Mt,s=wt;Ft.substract3(e,t,a),Ft.normalize3(a,a),Ft.normalize3(r,s),Ft.cross3(a,s,i),Ft.cross3(i,a,o),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=0,n[4]=o[0],n[5]=o[1],n[6]=o[2],n[7]=0,n[8]=a[0],n[9]=a[1],n[10]=a[2],n[11]=0},multiply3:function(t,e,r){r[0]=t[0]*e[0]+t[3]*e[1]+t[6]*e[2],r[1]=t[1]*e[0]+t[4]*e[1]+t[7]*e[2],r[2]=t[2]*e[0]+t[5]*e[1]+t[8]*e[2],r[3]=t[0]*e[3]+t[3]*e[4]+t[6]*e[5],r[4]=t[1]*e[3]+t[4]*e[4]+t[7]*e[5],r[5]=t[2]*e[3]+t[5]*e[4]+t[8]*e[5],r[6]=t[0]*e[6]+t[3]*e[7]+t[6]*e[8],r[7]=t[1]*e[6]+t[4]*e[7]+t[7]*e[8],r[8]=t[2]*e[6]+t[5]*e[7]+t[8]*e[8]},identity4:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},multiply4:function(t,e,r){var n=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],a=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],i=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],o=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],s=t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],c=t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],u=t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],f=t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],h=t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],l=t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],m=t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],v=t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],d=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],p=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],T=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],g=t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15];r[0]=n,r[1]=a,r[2]=i,r[3]=o,r[4]=s,r[5]=c,r[6]=u,r[7]=f,r[8]=h,r[9]=l,r[10]=m,r[11]=v,r[12]=d,r[13]=p,r[14]=T,r[15]=g},invert4:function(t,e){var r=Object(R.a)(t,16),n=r[0],a=r[1],i=r[2],o=r[3],s=r[4],c=r[5],u=r[6],f=r[7],h=r[8],l=r[9],m=r[10],v=r[11],d=r[12],p=r[13],T=r[14],g=r[15],E=n*c-s*a,y=n*l-h*a,b=n*p-d*a,_=s*l-h*c,A=s*p-d*c,O=h*p-d*l,x=i*f-u*o,M=i*v-m*o,w=i*g-T*o,k=u*v-m*f,F=u*g-T*f,L=m*g-T*v,U=E*L-y*F+b*k+_*w-A*M+O*x;if(Math.abs(U)<1e-8)return!1;var C=1/U;return e[0]=(c*L-l*F+p*k)*C,e[4]=(h*F-s*L-d*k)*C,e[8]=(f*O-v*A+g*_)*C,e[12]=(m*A-u*O-T*_)*C,e[1]=(l*w-a*L-p*M)*C,e[5]=(n*L-h*w+d*M)*C,e[9]=(v*b-o*O-g*y)*C,e[13]=(i*O-m*b+T*y)*C,e[2]=(a*F-c*w+p*x)*C,e[6]=(s*w-n*F-d*x)*C,e[10]=(o*A-f*b+g*E)*C,e[14]=(u*b-i*A-T*E)*C,e[3]=(c*M-a*k-l*x)*C,e[7]=(n*k-s*M+h*x)*C,e[11]=(f*y-o*_-v*E)*C,e[15]=(i*_-u*y+m*E)*C,!0},rotation4X:function(t,e){var r=Math.cos(t),n=Math.sin(t);e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1},rotation4Y:function(t,e){var r=Math.cos(t),n=Math.sin(t);e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1},rotation4Z:function(t,e){var r=Math.cos(t),n=Math.sin(t);e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}};var Ut={deg2rad:function(t){return t*Math.PI/180},rad2deg:function(t){return 180*t/Math.PI},cos:function(t){return _t[4095&(0|t)]},sin:function(t){return At[4095&(0|t)]},clamp:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t<e?e:t>r?r:t},vector:Ft,matrix:Lt,M4_00:0,M4_10:1,M4_20:2,M4_30:3,M4_01:4,M4_11:5,M4_21:6,M4_31:7,M4_02:8,M4_12:9,M4_22:10,M4_32:11,M4_03:12,M4_13:13,M4_23:14,M4_33:15,M3_00:0,M3_10:1,M3_20:2,M3_01:3,M3_11:4,M3_21:5,M3_02:6,M3_12:7,M3_22:8},Ct=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(){var t;Object(h.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).cameraMatrix=Ut.matrix.createMat4(),t.rotationY=Ut.matrix.createMat4(),t.rotationX=Ut.matrix.createMat4(),t}return Object(l.a)(r,[{key:"extractCameraMatrix",value:function(t){Ut.matrix.extract3From4(this.cameraMatrix,t)}},{key:"orbit",value:function(t,e,r,n,a,i){var o=this.rotationY,s=this.rotationX,c=this.cameraMatrix,u=Ut.clamp(a,-1.570796326794896,1.570796326794896),f=i;Ut.matrix.rotation4X(u,s),Ut.matrix.rotation4Y(-f,o),Ut.matrix.identity4(c),Ut.matrix.multiply4(s,o,c);var h=t,l=e,m=r+n;c[Ut.M4_03]=-h,c[Ut.M4_13]=-l,c[Ut.M4_23]=-m}}]),r}(bt),jt=r(18),St=r.n(jt),Dt=r(19),Nt=r.n(Dt),Pt=39.6*Math.PI/180,Bt=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(){var t;Object(h.a)(this,r),(t=e.call(this)).perspectiveMatrix=Ut.matrix.createMat4(),t.cameraMatrix3=Ut.matrix.createMat3(),t.fieldAngle=Pt,t.near=.1,t.far=1e3;return t.orbit(0,0,0,15,0,0),t}return Object(l.a)(r,[{key:"setUniformValues",value:function(t,e,r){var n=this.near,a=this.far,i=this.fieldAngle,o=Math.tan(.5*(Math.PI-i)),s=1/(n-a),c=this.perspectiveMatrix;c[Ut.M4_00]=o*r/e,c[Ut.M4_10]=0,c[Ut.M4_20]=0,c[Ut.M4_30]=0,c[Ut.M4_01]=0,c[Ut.M4_11]=o,c[Ut.M4_21]=0,c[Ut.M4_31]=0,c[Ut.M4_02]=0,c[Ut.M4_12]=0,c[Ut.M4_22]=(n+a)*s,c[Ut.M4_32]=-1,c[Ut.M4_03]=0,c[Ut.M4_13]=0,c[Ut.M4_23]=n*a*s*2,c[Ut.M4_33]=0,Ut.matrix.extract3From4(this.cameraMatrix,this.cameraMatrix3),t.use(),t.uniforms.set("uniCameraMatrix",this.cameraMatrix),t.uniforms.set("uniCameraMatrix3",this.cameraMatrix3),t.uniforms.set("uniPerspectiveMatrix",this.perspectiveMatrix)}},{key:"id",get:function(){return"[CAMERA/PERSPECTIVE]"}},{key:"vertexShader",get:function(){return{uniforms:{uniPerspectiveMatrix:"mat4",uniCameraMatrix:"mat4",uniCameraMatrix3:"mat3"},functions:{worldPointToScreen:St.a,worldVectorToScreen:Nt.a}}}}]),r}(Ct),Vt=function(){function t(e){var r=this;Object(h.a)(this,t),this.resolution=1,this.onAnimation=void 0,this._gl=void 0,this._pointer=void 0,this._isRendering=!1,this.lastRenderingTime=0,this.textures=void 0,this.buffers=void 0,this.programs=void 0,this.camera=new Bt,this.render=function(t){if(r._isRendering){window.requestAnimationFrame(r.render);var e=r.gl,n=r.lastRenderingTime;if(r.lastRenderingTime=t,0!==n){!function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e<=0?window.devicePixelRatio:e,n=t.canvas;if(n instanceof HTMLCanvasElement){var a=Math.floor(n.clientWidth*r),i=Math.floor(n.clientHeight*r);if(n.width!==a||n.height!==i)return n.width=a,n.height=i,t.viewport(0,0,a,i),!0}}(e,r.resolution),e.clearDepth(1),e.clear(e.DEPTH_BUFFER_BIT),e.depthFunc(e.LESS),e.disable(e.DEPTH_TEST);try{var a=r.onAnimation;if("function"===typeof a)a(t,e.drawingBufferWidth,e.drawingBufferHeight),r.pointer.reset()}catch(i){r._isRendering=!1,console.error("##################################"),console.error("# Rendering   has  been  stopped #"),console.error("# because of the following error #"),console.error("##################################"),console.error(i)}}}},this._pointer=new d(e);var n=e.getContext("webgl2",{});if(n||(console.warn("WebGL2 is not available! Switching to WebGL."),n=e.getContext("webgl",{})),!n)throw new Error("Unable to create a WegGL context!");this._gl=n,this.textures=new w(n),this.buffers=new yt(n),this.programs=new gt(n)}return Object(l.a)(t,[{key:"refresh",value:function(){var t=this._isRendering,e=this.lastRenderingTime;this._isRendering=!0;var r=Date.now();this.lastRenderingTime=r-15,this.render(r),this._isRendering=t,this.lastRenderingTime=e}},{key:"isRendering",get:function(){return this._isRendering},set:function(t){t!==this._isRendering&&(this._isRendering=t,t&&window.requestAnimationFrame(this.render))}},{key:"gl",get:function(){return this._gl}},{key:"pointer",get:function(){return this._pointer}},{key:"width",get:function(){return this._gl.drawingBufferWidth}},{key:"height",get:function(){return this._gl.drawingBufferHeight}}]),t}(),It=function(){function t(e,r){Object(h.a)(this,t),this.def=r,this.id=void 0,this.verticesCount=void 0,this.texturesCount=void 0,this.normalsCount=void 0,this.facesCount=void 0,this.id=e,this.verticesCount=Math.floor(r.vertices.length/3),this.texturesCount=Math.floor(r.textures.length/2),this.normalsCount=Math.floor(r.normals.length/3),this.facesCount=Math.floor(r.faces.length/9)}return Object(l.a)(t,[{key:"getVertexX",value:function(t){return Xt(t,this.verticesCount),this.def.vertices[3*t+0]}},{key:"getVertexY",value:function(t){return Xt(t,this.verticesCount),this.def.vertices[3*t+1]}},{key:"getVertexZ",value:function(t){return Xt(t,this.verticesCount),this.def.vertices[3*t+2]}},{key:"getTextureU",value:function(t){return Xt(t,this.texturesCount),this.def.textures[2*t+0]}},{key:"getTextureV",value:function(t){return Xt(t,this.texturesCount),this.def.textures[2*t+1]}},{key:"getNormalX",value:function(t){return Xt(t,this.normalsCount),this.def.normals[3*t+0]}},{key:"getNormalY",value:function(t){return Xt(t,this.normalsCount),this.def.normals[3*t+1]}},{key:"getNormalZ",value:function(t){return Xt(t,this.normalsCount),this.def.normals[3*t+2]}},{key:"getFaceSmoothness",value:function(t){return Xt(t,this.facesCount),"1"===this.def.smoothness.charAt(t)}},{key:"getFaceVertex",value:function(t,e){Xt(t,this.facesCount);var r=9*t+3*e+0;return this.def.faces[r]}},{key:"getFaceTexture",value:function(t,e){Xt(t,this.facesCount);var r=9*t+3*e+1;return this.def.faces[r]}},{key:"getFaceNormal",value:function(t,e){Xt(t,this.facesCount);var r=9*t+3*e+2;return this.def.faces[r]}}]),t}();function Xt(t,e){if(t<0||t>=e)throw"Index ".concat(t," is out of range [0..").concat(e-1,"]!")}var Gt=new M,Yt={createOrGetFromCacheMeshDefinition:function(t){return zt.apply(this,arguments)}};function zt(){return(zt=Object(f.a)(u.a.mark((function t(e){var r,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e,Gt.exists(e)){t.next=6;break}return t.next=4,p.loadJson(e);case 4:n=t.sent,Gt.add(r,new It(r,n));case 6:return t.abrupt("return",Gt.get(r));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Ht=new Float32Array([0,1,0]),Wt=function(){function t(){Object(h.a)(this,t),this.location=new Float32Array([0,0,0]),this.transfo=Ut.matrix.createMat4(),Ut.matrix.identity4(this.transfo)}return Object(l.a)(t,[{key:"lookAt",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ht;Ut.matrix.lookAt4(this.location,t,e,this.transfo)}},{key:"x",get:function(){return this.location[0]},set:function(t){this.location[0]=t,this.transfo[Ut.M4_03]=t}},{key:"y",get:function(){return this.location[1]},set:function(t){this.location[1]=t,this.transfo[Ut.M4_13]=t}},{key:"z",get:function(){return this.location[2]},set:function(t){this.location[2]=t,this.transfo[Ut.M4_23]=t}}]),t}(),Zt=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(t){var n;return Object(h.a)(this,r),(n=e.call(this)).params=t,n}return Object(l.a)(r,[{key:"paint",value:function(t){var e=this.params,r=e.scene,n=e.arrayBuffer,a=e.colorTexture,i=e.program,o=e.attributesCount,s=r.gl,c=r.camera;s.enable(s.CULL_FACE),s.cullFace(s.BACK),i.use(),c.setUniformValues(i,r.width,r.height,t),a.attachToUnit(0),i.uniforms.set("uniObjectTransfo",this.transfo),i.uniforms.set("uniTexture",0),i.bindAttribs(n.buffer),s.drawArrays(s.TRIANGLES,0,o)}},{key:"destroy",value:function(){var t=this.params,e=t.arrayBuffer,r=t.colorTexture;e.destroy(),r.destroy()}},{key:"program",get:function(){return this.params.program}}]),r}(Wt),qt=r(20),Jt=r.n(qt),Kt=r(21),$t=r.n(Kt),Qt={createAsync:function(t){return te.apply(this,arguments)}};function te(){return(te=Object(f.a)(u.a.mark((function t(e){var r,n,a,i,o,s,c,f,h,l,m;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.scene,n=e.definitionURL,a=e.colorTextureURL,i=r.camera,o="[FRESNEL]:".concat(n),t.next=5,Yt.createOrGetFromCacheMeshDefinition(n);case 5:return s=t.sent,c=ne(s),f=Math.floor(c.length/8),h=r.buffers.createArrayBuffer(o,c),t.next=11,r.textures.createImageTextureAsync({url:a,linear:!1});case 11:return l=t.sent,t.next=14,ee(r,i);case 14:return m=t.sent,t.abrupt("return",new Zt({scene:e.scene,arrayBuffer:h,attributesCount:f,colorTexture:l,program:m}));case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ee(t,e){return re.apply(this,arguments)}function re(){return(re=Object(f.a)(u.a.mark((function t(e,r){var n,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="[FRESNEL]:".concat(r.id),t.next=3,e.programs.createProgramAsync(n,{uniforms:{uniObjectTransfo:"mat4"},attributes:{attLocation:"vec3",attUV:"vec2",attNormal:"vec3"},varyings:{varNormal:"vec3",varReflexion:"vec3",varUV:"vec2"},functions:{main:Jt.a},dependencies:[r.vertexShader]},{uniforms:{uniTexture:"sampler2D"},functions:{main:$t.a}});case 3:return a=t.sent,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ne(t){for(var e=[],r=0;r<t.facesCount;r++)for(var n=0;n<3;n++){var a=t.getFaceVertex(r,n);e.push(t.getVertexX(a),t.getVertexY(a),t.getVertexZ(a));var i=t.getFaceTexture(r,n);e.push(t.getTextureU(i),t.getTextureV(i));var o=t.getFaceNormal(r,n);e.push(t.getNormalX(o),t.getNormalY(o),t.getNormalZ(o))}return new Float32Array(e)}var ae=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(t){var n;return Object(h.a)(this,r),(n=e.call(this)).params=t,n.color=new Float32Array([0,0,0,1]),n.thickness=1,console.info("params=",t),n}return Object(l.a)(r,[{key:"setRGB",value:function(t,e,r){var n=this.color;n[0]=t,n[1]=e,n[2]=r}},{key:"setRGBA",value:function(t,e,r,n){var a=this.color;a[0]=t,a[1]=e,a[2]=r,a[3]=n}},{key:"paint",value:function(t){var e=this.params,r=e.scene,n=e.arrayBuffer,a=e.program,i=e.attributesCount,o=r.gl,s=r.camera;o.enable(o.CULL_FACE),o.cullFace(o.FRONT),a.use(),s.setUniformValues(a,r.width,r.height,t),a.uniforms.set("uniColor",this.color),a.uniforms.set("uniThickness",.001*this.thickness),a.uniforms.set("uniObjectTransfo",this.transfo),a.bindAttribs(n.buffer),o.drawArrays(o.TRIANGLES,0,i)}},{key:"destroy",value:function(){this.params.arrayBuffer.destroy()}},{key:"program",get:function(){return this.params.program}}]),r}(Wt),ie=r(22),oe=r.n(ie),se=r(23),ce=r.n(se),ue={createAsync:function(t){return fe.apply(this,arguments)}};function fe(){return(fe=Object(f.a)(u.a.mark((function t(e){var r,n,a,i,o,s,c,f;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.scene,n=e.definitionURL,a="[OUTLINE]:".concat(n),t.next=4,Yt.createOrGetFromCacheMeshDefinition(n);case 4:return i=t.sent,o=me(i),s=Math.floor(o.length/6),c=r.buffers.createArrayBuffer(a,o),t.next=10,he(r);case 10:return f=t.sent,t.abrupt("return",new ae({scene:r,arrayBuffer:c,attributesCount:s,program:f}));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function he(t){return le.apply(this,arguments)}function le(){return(le=Object(f.a)(u.a.mark((function t(e){var r,n,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.camera,n="[OUTLINE]:".concat(r.id),t.next=4,e.programs.createProgramAsync(n,{uniforms:{uniObjectTransfo:"mat4",uniThickness:"float"},attributes:{attLocation:"vec3",attNormal:"vec3"},functions:{main:oe.a},dependencies:[r.vertexShader]},{uniforms:{uniColor:"vec4"},functions:{main:ce.a}});case 4:return a=t.sent,t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function me(t){for(var e=[],r=[],n=0;n<t.facesCount;n++)for(var a=0;a<3;a++){var i=t.getFaceVertex(n,a);r[i]||(r[i]=new ve(t.getVertexX(i),t.getVertexY(i),t.getVertexZ(i)));var o=r[i],s=t.getFaceNormal(n,a);o.addNormal(t.getNormalX(s),t.getNormalY(s),t.getNormalZ(s))}for(var c=0;c<t.facesCount;c++)for(var u=0;u<3;u++){var f=r[t.getFaceVertex(c,u)];e.push.apply(e,Object(k.a)(f.data))}return console.info("data=",e),new Float32Array(e)}var ve=function(){function t(e,r,n){Object(h.a)(this,t),this.x=e,this.y=r,this.z=n,this.normalX=0,this.normalY=0,this.normalZ=0,this.normalsCount=0}return Object(l.a)(t,[{key:"addNormal",value:function(t,e,r){this.normalX+=t,this.normalY+=e,this.normalZ+=r,this.normalsCount++}},{key:"data",get:function(){var t=Math.max(1,this.normalsCount),e=this.normalX/t,r=this.normalY/t,n=this.normalZ/t,a=1/Math.sqrt(e*e+r*r+n*n);return[this.x,this.y,this.z,e*a,r*a,n*a]}}]),t}(),de={Fresnel:Qt,Outline:ue},pe=function(t,e){return Object(f.a)(u.a.mark((function r(){var n,a;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,de.Fresnel.createAsync({colorTextureURL:"./assets/palette/default-64.png",definitionURL:e,scene:t});case 2:return n=r.sent,r.next=5,de.Outline.createAsync({definitionURL:e,scene:t});case 5:return a=r.sent,r.abrupt("return",new Te(n,a));case 7:case"end":return r.stop()}}),r)})))()},Te=function(){function t(e,r){Object(h.a)(this,t),this.body=e,this.outline=r}return Object(l.a)(t,[{key:"paint",value:function(t){this.outline.paint(t),this.body.paint(t)}},{key:"color",get:function(){return this.outline.color}},{key:"thickness",get:function(){return this.outline.thickness},set:function(t){this.outline.thickness=t}},{key:"x",get:function(){return this.body.x},set:function(t){this.body.x=t,this.outline.x=t}},{key:"y",get:function(){return this.body.y},set:function(t){this.body.y=t,this.outline.y=t}},{key:"z",get:function(){return this.body.z},set:function(t){this.body.z=t,this.outline.z=t}}]),t}(),ge=(r(61),n.a.View.Slider),Ee=function(t){Object(m.a)(r,t);var e=Object(v.a)(r);function r(){var t;Object(h.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))).state={thickness:2,distance:35},t.refCanvas=i.a.createRef(),t.scene=void 0,t}return Object(l.a)(r,[{key:"componentDidMount",value:function(){var t=Object(f.a)(u.a.mark((function t(){var e,r,n,a,i,o,s,c,f=this;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.refCanvas.current){t.next=3;break}return t.abrupt("return");case 3:return(r=new Vt(e)).camera=new Bt,n=r.gl,t.next=8,pe(r,"./assets/mesh/Car.json");case 8:return a=t.sent,t.next=11,pe(r,"./assets/mesh/Island-A.json");case 11:(i=t.sent).thickness=2,o=35,s=0,c=30,r.onAnimation=function(t){n.clearColor(.2,.3,.4,1),n.clearDepth(1),n.depthFunc(n.LESS),n.enable(n.DEPTH_TEST),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),i.thickness=f.state.thickness,a.thickness=f.state.thickness,a.y=3*Math.abs(Math.cos(.002*t)),a.x=3+3*Math.sin(.002*t),c=314e-6*t,s=Math.cos(4841e-7*t),o=f.state.distance,r.camera.orbit(a.x,0,0,o,s,c),i.paint(t),a.paint(t)},this.scene=r,r.isRendering=!0;case 19:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=["App","thm-bg0"];return this.props.className&&e.push(this.props.className),i.a.createElement("div",{className:e.join(" ")},i.a.createElement("canvas",{ref:this.refCanvas}),i.a.createElement("div",{className:"controls"},i.a.createElement(ge,{label:"Thickness",min:0,max:20,step:1,value:this.state.thickness,onChange:function(e){return t.setState({thickness:e})}}),i.a.createElement(ge,{label:"Distance",min:1,max:100,step:1,value:this.state.distance,onChange:function(e){return t.setState({distance:e})}})))}}]),r}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n.a.Theme.register("default",{bg0:"#222",bg3:"#555"}),n.a.Theme.apply("default"),n.a.Font.loadJosefin(),s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(Ee,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[24,1,2]]]);
//# sourceMappingURL=main.2526d41d.chunk.js.map